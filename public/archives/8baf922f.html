<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Linux-Shell基础 | 尤妤</title><meta name="keywords" content="Linux,Shell"><meta name="author" content="尤妤"><meta name="copyright" content="尤妤"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Shell基础Bash注释 Bash只支持单行注释，使用#开头的都被当作注释语句 123# 单行注释echo &quot;Hello World&quot;	#注释    通过Bash特性，可以实现多行注释 12345678:&amp;#x27;注释&amp;#x27;: &lt;&lt;&amp;#x27;EOF&amp;#x27;注释EOF  Bash基本数据类型 Bash中基本数据类型只有字符串类型，连数值类型都没有 12">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux-Shell基础">
<meta property="og:url" content="https://www.xiaowangc.com/archives/8baf922f.html">
<meta property="og:site_name" content="尤妤">
<meta property="og:description" content="Shell基础Bash注释 Bash只支持单行注释，使用#开头的都被当作注释语句 123# 单行注释echo &quot;Hello World&quot;	#注释    通过Bash特性，可以实现多行注释 12345678:&amp;#x27;注释&amp;#x27;: &lt;&lt;&amp;#x27;EOF&amp;#x27;注释EOF  Bash基本数据类型 Bash中基本数据类型只有字符串类型，连数值类型都没有 12">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.xiaowangc.com/img/fengmian/linux.png">
<meta property="article:published_time" content="2022-11-06T18:27:59.000Z">
<meta property="article:modified_time" content="2022-11-07T07:59:31.000Z">
<meta property="article:author" content="尤妤">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Shell">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.xiaowangc.com/img/fengmian/linux.png"><link rel="shortcut icon" href="/img/touxiang.jpg"><link rel="canonical" href="https://www.xiaowangc.com/archives/8baf922f"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 尤妤","link":"链接: ","source":"来源: 尤妤","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Linux-Shell基础',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-07 15:59:31'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/touxiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">58</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">53</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-screwdriver-wrench"></i><span> 工具</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://api.xiaowangc.com"><i class="fa-fw fas fa-location-dot"></i><span> IP地址查询</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://decoder.link/"><i class="fa-fw fa-brands fa-expeditedssl"></i><span> TLS检测工具</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://freessl.cn/"><i class="fa-fw fas fa-lock"></i><span> TLS证书申请1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://letsencrypt.org/"><i class="fa-fw fas fa-lock"></i><span> TLS证书申请2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.sslforfree.com/"><i class="fa-fw fas fa-lock"></i><span> TLS证书申请3</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://awesome-prometheus-alerts.grep.to/"><i class="fa-fw fa-brands fa-watchman-monitoring"></i><span> PromAlertRules</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://ssl-config.mozilla.org/"><i class="fa-fw fa-brands fa-expeditedssl"></i><span> TLS配置生成器</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/fengmian/linux.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">尤妤</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-screwdriver-wrench"></i><span> 工具</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://api.xiaowangc.com"><i class="fa-fw fas fa-location-dot"></i><span> IP地址查询</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://decoder.link/"><i class="fa-fw fa-brands fa-expeditedssl"></i><span> TLS检测工具</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://freessl.cn/"><i class="fa-fw fas fa-lock"></i><span> TLS证书申请1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://letsencrypt.org/"><i class="fa-fw fas fa-lock"></i><span> TLS证书申请2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.sslforfree.com/"><i class="fa-fw fas fa-lock"></i><span> TLS证书申请3</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://awesome-prometheus-alerts.grep.to/"><i class="fa-fw fa-brands fa-watchman-monitoring"></i><span> PromAlertRules</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://ssl-config.mozilla.org/"><i class="fa-fw fa-brands fa-expeditedssl"></i><span> TLS配置生成器</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Linux-Shell基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-06T18:27:59.000Z" title="发表于 2022-11-07 02:27:59">2022-11-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-07T07:59:31.000Z" title="更新于 2022-11-07 15:59:31">2022-11-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Linux-Shell基础"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Shell基础"><a href="#Shell基础" class="headerlink" title="Shell基础"></a>Shell基础</h1><h2 id="Bash注释"><a href="#Bash注释" class="headerlink" title="Bash注释"></a>Bash注释</h2><ul>
<li><p>Bash只支持单行注释，使用<code>#</code>开头的都被当作注释语句</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">单行注释</span></span><br><span class="line"></span><br><span class="line">echo &quot;Hello World&quot;	#注释</span><br></pre></td></tr></table></figure>


</li>
<li><p>通过Bash特性，可以实现多行注释</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">:&#x27;</span><br><span class="line">注释</span><br><span class="line">&#x27;</span><br><span class="line"></span><br><span class="line">: &lt;&lt;&#x27;EOF&#x27;</span><br><span class="line">注释</span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Bash基本数据类型"><a href="#Bash基本数据类型" class="headerlink" title="Bash基本数据类型"></a>Bash基本数据类型</h2><ul>
<li><p>Bash中基本数据类型只有字符串类型，连数值类型都没有</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">都是字符串类型，可用<span class="built_in">declare</span> -i声明为数值类型</span></span><br><span class="line">[root@localhost ~]# echo hello</span><br><span class="line">[root@localhost ~]# echo 123</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Bash字符串串联"><a href="#Bash字符串串联" class="headerlink" title="Bash字符串串联"></a>Bash字符串串联</h2><ul>
<li><p>Bash中字符串的串联操作，可用将两段数据连接在一起</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo xiaowang xiaowangc</span><br><span class="line">xiaowang xiaowangc</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="变量赋值和引用变量"><a href="#变量赋值和引用变量" class="headerlink" title="变量赋值和引用变量"></a>变量赋值和引用变量</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# a=xiaowangc</span><br><span class="line">[root@localhost ~]# echo $a</span><br><span class="line">xiaowangc</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Shell可用使用未定义的变量和使用空变量</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo $abc</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# a=</span><br><span class="line">[root@localhost ~]# echo $a</span><br><span class="line"></span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure>
</li>
<li><p>变量引用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# a=666</span><br><span class="line">[root@localhost ~]# echo $a 777</span><br><span class="line">666 777</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="命令替换"><a href="#命令替换" class="headerlink" title="命令替换"></a>命令替换</h2><ul>
<li><p>命令替换是值先执行id root，将id root的输出结果替换到$()</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo $(id root)</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="算数运算"><a href="#算数运算" class="headerlink" title="算数运算"></a>算数运算</h2><ul>
<li><p>Shell可用使用$[]和$(())和let命令做算数运算</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# a=10</span><br><span class="line">[root@localhost ~]# echo $[a+3]</span><br><span class="line">13</span><br><span class="line">[root@localhost ~]# echo $((a+3))</span><br><span class="line">13</span><br><span class="line">[root@localhost ~]# echo $((1+1))</span><br><span class="line">2</span><br><span class="line">[root@localhost ~]# let a+3</span><br><span class="line">[root@localhost ~]# let a=a+3</span><br><span class="line">[root@localhost ~]# echo $a</span><br><span class="line">13</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="退出状态码"><a href="#退出状态码" class="headerlink" title="退出状态码"></a>退出状态码</h2><blockquote>
<p>每个命令执行之后都有对应的进程退出状态码，用来表示该进程是否正常退出。所以，在Shell中经常会使用特殊变量$?判断前台命令是否正常退出。</p>
</blockquote>
<ul>
<li>如果$?的值为：<ul>
<li>为0，表示进程成功执行，即正常退出</li>
<li>非0，表示进程未成功执行，即非正常退出</li>
<li>非0退出状态码不一定表示错误，也可能是逻辑上正常的退出</li>
</ul>
</li>
<li>在Shell脚本中，所有条件判断（比如if语句、while语句）都以0退出状态码表示True，以非0退出状态码表示False</li>
</ul>
<h2 id="Exit命令"><a href="#Exit命令" class="headerlink" title="Exit命令"></a>Exit命令</h2><blockquote>
<p>exit命令可用于退出当前Shell进程。退出Shell终端、脚本等。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">exit</span></span></span><br></pre></td></tr></table></figure>



<h2 id="后台执行命令-amp"><a href="#后台执行命令-amp" class="headerlink" title="后台执行命令&amp;"></a>后台执行命令&amp;</h2><blockquote>
<p>在命令的结尾使用&amp;符号，表示将这个命令放入后台执行。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sleep 20 &amp;</span><br><span class="line">[root@localhost ~]# echo $!</span><br></pre></td></tr></table></figure>



<h2 id="多命令组合"><a href="#多命令组合" class="headerlink" title="多命令组合"></a>多命令组合</h2><blockquote>
<p>Shell中有多种组合多个命令的方式</p>
</blockquote>
<ul>
<li><p>分号</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo xiaowangc ; echo hello</span><br><span class="line">xiaowangc</span><br><span class="line">hello</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure>
</li>
<li><p>&amp;&amp;</p>
<p>前者正确执行完毕并正常退出后，执行后者命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo xiaowangc &amp;&amp; echo hello</span><br><span class="line">xiaowangc</span><br><span class="line">hello</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure>
</li>
<li><p>||；如果前者正确只执行前者，前者不正确执行后者（或）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ping asdf &amp;&amp; ping www.baidu.com</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# ping -c 4 www.baidu.com || ping abc</span><br></pre></td></tr></table></figure>
</li>
<li><p>逻辑结合</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令1 &amp;&amp; 命令2 &amp;&amp; 命令3...</span>  </span><br><span class="line">如果命令1正确执行则执行命令2，如果命令2正确执行则执行命令3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令1 &amp;&amp; 命令2 || 命令3...</span></span><br><span class="line">如果命令1正确执行则执行命令2，如果命令1不正确执行则执行命令3</span><br><span class="line">如果命令1正确执行则执行命令2，如果命令2不正确执行则执行命令3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令1 || 命令2 &amp;&amp; 命令3...</span></span><br><span class="line">如果命令1正确执行则执行命令3</span><br><span class="line">如果命令1不正确执行则执行命令2，如果命令2正确执行则执行命令3</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="多个命令组合"><a href="#多个命令组合" class="headerlink" title="多个命令组合"></a>多个命令组合</h2><ul>
<li><p>通过小括号或者大括号组合多个命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(命令1 ; 命令2 ; 命令3)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">小括号是在子Shell中执行</span></span><br><span class="line"></span><br><span class="line">&#123; 命令1 ; 命令2 ; 命令3&#125;</span><br><span class="line">&#123;</span><br><span class="line">	命令1</span><br><span class="line">	命令2</span><br><span class="line">	命令3</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">大括号当前Shell中执行</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h2><blockquote>
<p>标准输入、标准输出、标准错误，在Linux系统中，每个程序默认都会打开三个文件描述符</p>
</blockquote>
<ul>
<li>fd&#x3D;0：标准输入</li>
<li>fd&#x3D;1：标准输出</li>
<li>fd&#x3D;2：标准错误</li>
</ul>
<p>Linux中一切皆文件，文件描述符也是文件：</p>
<ul>
<li>fd &#x3D; 0：对应&#x2F;dev&#x2F;stdin文件</li>
<li>fd &#x3D; 1：对应&#x2F;dev&#x2F;stdout文件</li>
<li>fd &#x3D; 2：对应&#x2F;dev&#x2F;stderr文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ls -l /dev/std*</span><br><span class="line">lrwxrwxrwx. 1 root root 15 May  3 04:28 /dev/stderr -&gt; /proc/self/fd/2</span><br><span class="line">lrwxrwxrwx. 1 root root 15 May  3 04:28 /dev/stdin -&gt; /proc/self/fd/0</span><br><span class="line">lrwxrwxrwx. 1 root root 15 May  3 04:28 /dev/stdout -&gt; /proc/self/fd/1</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure>



<h3 id="重定向操作"><a href="#重定向操作" class="headerlink" title="重定向操作"></a>重定向操作</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. &gt; #格式化输出</span><br><span class="line"></span><br><span class="line">2. &gt;&gt; #追加输出</span><br><span class="line"></span><br><span class="line">3. &lt; #输入重定向</span><br><span class="line"></span><br><span class="line">4. &amp;&gt; #特殊重定向，将标准错误和标准输出都重定向到指定的File中,等价于&gt;file 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">5. &amp;&gt;&gt; #特殊重定向,将标准错误和标准输出都追加到指定File中，等价于&gt;&gt;file 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>还有一种操作经常将输出的目标文件指定为&#x2F;dev&#x2F;null。它是空设备，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /dev/null &gt; file  #清空文件</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="cat命令"><a href="#cat命令" class="headerlink" title="cat命令"></a>cat命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat -n /etc/fstab		#-n选项，输出时带行号</span><br><span class="line">     1</span><br><span class="line">     2  #</span><br><span class="line">     3  # /etc/fstab</span><br><span class="line">     4  # Created by anaconda on Sun May  2 20:23:48 2021</span><br><span class="line">     5  #</span><br><span class="line">     6  # Accessible filesystems, by reference, are maintained under &#x27;/dev/disk/&#x27;.</span><br><span class="line">     7  # See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span><br><span class="line">     8  #</span><br><span class="line">     9  # After editing this file, run &#x27;systemctl daemon-reload&#x27; to update systemd</span><br><span class="line">    10  # units generated from this file.</span><br><span class="line">    11  #</span><br><span class="line">    12  /dev/mapper/cl-root     /                       xfs     defaults        0 0</span><br><span class="line">    13  UUID=ffc9c9ba-0b05-43c3-8241-e19518b8c840 /boot                   ext4    defaults        1 2</span><br><span class="line">    14  /dev/mapper/cl-swap     swap                    swap    defaults        0 0</span><br><span class="line">[root@localhost ~]# cat &lt; /etc/fstab</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># /etc/fstab</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Created by anaconda on Sun May  2 20:23:48 2021</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk/&#x27;.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) <span class="keyword">for</span> more info.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># After editing this file, run &#x27;systemctl daemon-reload&#x27; to update systemd</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">units generated from this file.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">/dev/mapper/cl-root     /                       xfs     defaults        0 0</span></span><br><span class="line">UUID=ffc9c9ba-0b05-43c3-8241-e19518b8c840 /boot                   ext4    defaults        1 2</span><br><span class="line">/dev/mapper/cl-swap     swap                    swap    defaults        0 0</span><br><span class="line">[root@localhost ~]#</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="here-docer"><a href="#here-docer" class="headerlink" title="here docer"></a>here docer</h3><p>输入重定向是&lt;，除此之外还有&lt;&lt;,&lt;&lt;&lt;</p>
<ul>
<li><p>&lt;&lt;符号表示here doc，也就是后面表示跟着的是一篇文档。常用于多行数据输入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat &lt;&lt; EOF		#here doc作为标准输入被读取，然后被cat输出</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">hello</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">xiaowangc</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">EOF</span></span><br><span class="line">hello</span><br><span class="line">xiaowangc</span><br><span class="line">[root@localhost ~]# cat &lt;&lt; EOF &gt; xiaowangc.txt	#here doc的内容还会被cat格式化输出到指定文档</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">hello</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">xiaowangc</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">EOF</span></span><br><span class="line">[root@localhost ~]# cat xiaowangc.txt</span><br><span class="line">hello</span><br><span class="line">xiaowangc</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure>
</li>
<li><p>&lt;&lt;&lt;表示here string。也就是说该符号后面是一个字符串</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat &lt;&lt;&lt; xiaowangc</span><br><span class="line">xiaowangc</span><br><span class="line">[root@localhost ~]# a=11111</span><br><span class="line">[root@localhost ~]# cat &lt;&lt;&lt; $a</span><br><span class="line">11111</span><br><span class="line">[root@localhost ~]# cat &lt;&lt;&lt; &quot;xiaowangc$a&quot;	#使用双引号时会进行替换</span><br><span class="line">xiaowangc11111</span><br><span class="line">[root@localhost ~]# cat &lt;&lt;&lt; &#x27;xiaowangc$a&#x27;	#使用单引号时不会进行替换</span><br><span class="line"><span class="meta prompt_">xiaowangc$</span><span class="language-bash">a</span></span><br><span class="line">[root@localhost ~]#</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h2><blockquote>
<p>每一个竖线”|“代表一个管道，第一个命令的标准输出会放进管道，第二个命令会从管道中读取进行处理</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ps -aux | grep sshd</span><br><span class="line">root        1005  0.0  0.5  92968  4280 ?        Ss   May08   0:00 /usr/sbin/sshd -D -oCiphers=aes256-gcm@openssh.com,chacha20-poly1305@openssh.com,aes256-ctr,aes256-cbc,aes128-gcm@openssh.com,aes128-ctr,aes128-cbc -oMACs=hmac-sha2-256-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha2-256,hmac-sha1,umac-128@openssh.com,hmac-sha2-512 -oGSSAPIKexAlgorithms=gss-gex-sha1-,gss-group14-sha1- -oKexAlgorithms=curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group14-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1 -oHostKeyAlgorithms=rsa-sha2-256,rsa-sha2-256-cert-v01@openssh.com,ecdsa-sha2-nistp256,ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp384,ecdsa-sha2-nistp384-cert-v01@openssh.com,rsa-sha2-512,rsa-sha2-512-cert-v01@openssh.com,ecdsa-sha2-nistp521,ecdsa-sha2-nistp521-cert-v01@openssh.com,ssh-ed25519,ssh-ed25519-cert-v01@openssh.com,ssh-rsa,ssh-rsa-cert-v01@openssh.com -oPubkeyAcceptedKeyTypes=rsa-sha2-256,rsa-sha2-256-cert-v01@openssh.com,ecdsa-sha2-nistp256,ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp384,ecdsa-sha2-nistp384-cert-v01@openssh.com,rsa-sha2-512,rsa-sha2-512-cert-v01@openssh.com,ecdsa-sha2-nistp521,ecdsa-sha2-nistp521-cert-v01@openssh.com,ssh-ed25519,ssh-ed25519-cert-v01@openssh.com,ssh-rsa,ssh-rsa-cert-v01@openssh.com -oCASignatureAlgorithms=rsa-sha2-256,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,rsa-sha2-512,ecdsa-sha2-nistp521,ssh-ed25519,ssh-rsa</span><br><span class="line">root       55071  0.0  1.2 152904  9960 ?        Ss   05:23   0:00 sshd: root [priv]</span><br><span class="line">root       55085  0.0  0.6 152904  5060 ?        S    05:23   0:00 sshd: root@pts/0</span><br><span class="line">root       58868  0.0  0.1  12112  1040 pts/0    R+   07:35   0:00 grep --color=auto sshd</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure>

<p>让grep既从&#x2F;etc&#x2F;fstab读取数据，也从管道中读取数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ps aux | grep &quot;#&quot; /etc/fstab /dev/stdin</span><br><span class="line">/etc/fstab:#</span><br><span class="line">/etc/fstab:# /etc/fstab</span><br><span class="line">/etc/fstab:# Created by anaconda on Sun May  2 20:23:48 2021</span><br><span class="line">/etc/fstab:#</span><br><span class="line">/etc/fstab:# Accessible filesystems, by reference, are maintained under &#x27;/dev/disk/&#x27;.</span><br><span class="line">/etc/fstab:# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span><br><span class="line">/etc/fstab:#</span><br><span class="line">/etc/fstab:# After editing this file, run &#x27;systemctl daemon-reload&#x27; to update systemd</span><br><span class="line">/etc/fstab:# units generated from this file.</span><br><span class="line">/etc/fstab:#</span><br><span class="line">/dev/stdin:zabbix     19079  0.0  0.3  76692  2584 ?        S    May08   0:00 /usr/sbin/zabbix_agentd: listener #1 [waiting for connection]</span><br><span class="line">/dev/stdin:zabbix     19080  0.0  0.3  76692  2592 ?        S    May08   0:00 /usr/sbin/zabbix_agentd: listener #2 [waiting for connection]</span><br><span class="line">/dev/stdin:zabbix     19081  0.0  0.3  76692  2672 ?        S    May08   0:00 /usr/sbin/zabbix_agentd: listener #3 [waiting for connection]</span><br><span class="line">/dev/stdin:zabbix     19082  0.0  0.3  76692  2848 ?        S    May08   0:04 /usr/sbin/zabbix_agentd: active checks #1 [idle 1 sec]</span><br><span class="line">/dev/stdin:root       58944  0.0  0.1  12112  1000 pts/0    R+   07:38   0:00 grep --color=auto # /etc/fstab /dev/stdin</span><br><span class="line">[root@localhost ~]#</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="tee命令"><a href="#tee命令" class="headerlink" title="tee命令"></a>tee命令</h2><blockquote>
<p>tee命令可以将标准输入复制到标准输出和0或多个文件中。tee的作用是数据多重定向</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo hello | tee /tmp/xiaowangc /tmp/xiaowc | cat</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>



<h2 id="条件测试语句"><a href="#条件测试语句" class="headerlink" title="条件测试语句"></a>条件测试语句</h2><p>test命令或Bash内置命令[ ]可以做条件测试，如果测试的结果为True，则退出的状态码为0</p>
<p>这些条件测试常用在if、while语句中</p>
<ul>
<li><p>true和false命令</p>
<p>true命令返回true，退出码为0</p>
<p>false命令返回false，退出码非0</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# true</span><br><span class="line">[root@localhost ~]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@localhost ~]# false</span><br><span class="line">[root@localhost ~]# echo $?</span><br><span class="line">1</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure>
</li>
<li><p>文件类测试</p>
<table>
<thead>
<tr>
<th align="center">条件表达式</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-e</td>
<td align="center">判断文件是否存在</td>
</tr>
<tr>
<td align="center">-f</td>
<td align="center">判断文件是否存在且为普通文件</td>
</tr>
<tr>
<td align="center">-b</td>
<td align="center">判断文件是否存在且为块设备</td>
</tr>
<tr>
<td align="center">-c</td>
<td align="center">判断文件是否存在且为字符设备</td>
</tr>
<tr>
<td align="center">-S</td>
<td align="center">判断文件是否存在且为套接字文件</td>
</tr>
<tr>
<td align="center">-p</td>
<td align="center">判断文件是否存在且为命令管道文件</td>
</tr>
<tr>
<td align="center">-l</td>
<td align="center">判断文件是否存在且为一个链接文件</td>
</tr>
<tr>
<td align="center">-d</td>
<td align="center">判断文件是否存在且为普通目录</td>
</tr>
</tbody></table>
</li>
<li><p>文件属性类测试</p>
<table>
<thead>
<tr>
<th align="center">条件表达式</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-r</td>
<td align="center">文件是否存在且当前用户可读</td>
</tr>
<tr>
<td align="center">-w</td>
<td align="center">文件是否存在且当前用户可写</td>
</tr>
<tr>
<td align="center">-x</td>
<td align="center">文件是否存在且当前用户可执行</td>
</tr>
<tr>
<td align="center">-s</td>
<td align="center">文件是否存在且为非空文件</td>
</tr>
<tr>
<td align="center">-N</td>
<td align="center">文件是否存在，且上次read后是否被modify</td>
</tr>
</tbody></table>
</li>
<li><p>两个文件之间的比较</p>
<table>
<thead>
<tr>
<th align="center">条件表达式</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">file1 -nt file2</td>
<td align="center">判断file1是否比file2新</td>
</tr>
<tr>
<td align="center">file1 -ot file2</td>
<td align="center">判断file1是否比file2旧</td>
</tr>
<tr>
<td align="center">file1 -ef file2</td>
<td align="center">判断file1与file2是否为同一文件</td>
</tr>
</tbody></table>
</li>
<li><p>数值大小比较</p>
<table>
<thead>
<tr>
<th align="center">条件表达式</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">int1 -eq int2</td>
<td align="center">两个数值相等</td>
</tr>
<tr>
<td align="center">int1 -ne int2</td>
<td align="center">两个数值不相等</td>
</tr>
<tr>
<td align="center">int1 -gt int2</td>
<td align="center">n1大于n2</td>
</tr>
<tr>
<td align="center">int1 -lt int2</td>
<td align="center">n1小于n2</td>
</tr>
<tr>
<td align="center">int1 -ge int2</td>
<td align="center">n1大于等于n2</td>
</tr>
<tr>
<td align="center">int1 -le int2</td>
<td align="center">n1小于等于n2</td>
</tr>
</tbody></table>
</li>
<li><p>字符串比较</p>
<table>
<thead>
<tr>
<th align="center">条件表达式</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-z str</td>
<td align="center">判断字符串是否为空，返回true</td>
</tr>
<tr>
<td align="center">str or -n str</td>
<td align="center">判断字符串是否为空，返回falsh</td>
</tr>
<tr>
<td align="center">str1 &#x3D; str2 or str1 &#x3D;&#x3D; str2</td>
<td align="center">判断str1和str2是否相同，相同则返回true</td>
</tr>
<tr>
<td align="center">str1 ！&#x3D; str2</td>
<td align="center">判断str1是否不等于str2</td>
</tr>
<tr>
<td align="center">str1 &gt; str2</td>
<td align="center">判断str1是否大于str2</td>
</tr>
<tr>
<td align="center">str1 &lt; str</td>
<td align="center">判断str1是否小于str2</td>
</tr>
</tbody></table>
</li>
<li><p>逻辑运算符</p>
<table>
<thead>
<tr>
<th align="center">条件表达式</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-a or &amp;&amp;</td>
<td align="center">两表达式同时为true才为true</td>
</tr>
<tr>
<td align="center">-o or ||</td>
<td align="center">两表达式任何一个为true则为true</td>
</tr>
<tr>
<td align="center">！</td>
<td align="center">对表达式取反</td>
</tr>
<tr>
<td align="center">（）</td>
<td align="center">更改表达式优先级</td>
</tr>
</tbody></table>
</li>
</ul>
<h2 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if 条件判断式1; then</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">当条件满足时，执行的语句</span></span><br><span class="line">	语句;</span><br><span class="line">[elif 条件判断式2; then</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">当条件满足时，执行的语句;]</span></span><br><span class="line">[else 所有条件不成立时，执行此语句;]</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">test-commands既可以是<span class="built_in">test</span>测试或[]、[[]]测试，也可以是任何其他命令，test-commands用于条件测试，它只判断命令的退出状态码是否为0，为0则为<span class="literal">true</span></span></span><br></pre></td></tr></table></figure>



<p>实例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/sh</span></span><br><span class="line">dir_d=/media/disk_d		#定义了三个变量</span><br><span class="line">dir_e=/media/disk_e</span><br><span class="line">dir_f=/media/disk_f</span><br><span class="line"></span><br><span class="line">a=`ls $dir_d | wc -l`	#将ls和wl命令运行的返回值赋值给a、b、c</span><br><span class="line">b=`ls $dir_e | wc -l`</span><br><span class="line">c=`ls $dir_f | wc -l`</span><br><span class="line">echo &quot;检查 disk_d..&quot;</span><br><span class="line">if [ $a -eq 0 ]; then	#判断$a变量是否等于0，等于0则代表不存在</span><br><span class="line">    echo &quot;disk_d 不存在,现在开始创建...&quot;		</span><br><span class="line">    sudo  mount -t ntfs /dev/disk/by-label/software /media/disk_d	#挂载</span><br><span class="line">else	</span><br><span class="line">    echo &quot;disk_d 存在&quot;	</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>



<h2 id="case"><a href="#case" class="headerlink" title="case"></a>case</h2><p>case用于确定的分支判断。</p>
<p>实例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line">case $a in</span><br><span class="line">	&quot;1&quot;)</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">执行此语句</span></span><br><span class="line">		;;</span><br><span class="line">	&quot;2&quot;)</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">执行此语句</span></span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">如果都不满足则执行此语句</span></span><br><span class="line">		;;</span><br><span class="line">esac</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">case</span>以<span class="keyword">case</span>开头，以<span class="keyword">esac</span>结尾</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在每个分支后面都要以;;结尾</span></span><br></pre></td></tr></table></figure>



<h2 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h2><blockquote>
<p>两种for循环结构：</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">第一种</span></span><br><span class="line">for i in s1 s2 s3 ...;do 语句;done</span><br><span class="line"></span><br><span class="line">for i in s1 s2 s3;do</span><br><span class="line">  语句</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">第二种</span></span><br><span class="line">for ((初始化；循环控制条件；变量变化));</span><br><span class="line">do</span><br><span class="line">语句</span><br><span class="line">done</span><br></pre></td></tr></table></figure>



<h2 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while 测试条件;</span><br><span class="line">do</span><br><span class="line">	语句</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<blockquote>
<p>​	无限循环的写法</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">while :</span><br><span class="line">do</span><br><span class="line">	命令</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">while true</span><br><span class="line">do</span><br><span class="line">	命令</span><br><span class="line">done</span><br></pre></td></tr></table></figure>



<h2 id="Shell函数"><a href="#Shell函数" class="headerlink" title="Shell函数"></a>Shell函数</h2><p>Shell函数可以当作命令一样执行，它是一个或多个命令的组合结构体。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Shell函数的几种语法格式</span></span><br><span class="line"></span><br><span class="line">function 函数名 &#123; 命令 &#125;</span><br><span class="line">函数名() &#123; 命令 &#125;</span><br><span class="line">function 函数名() &#123;  命令 &#125;</span><br></pre></td></tr></table></figure>

<p>函数定义后，可以直接使用函数名来进行调用，同时可以向函数传递0个或多个参数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">不传递参数</span></span><br><span class="line">函数名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">传递多个参数</span></span><br><span class="line">函数名 参数1 参数2 参数3 ...</span><br></pre></td></tr></table></figure>

<ul>
<li>在函数中，那些位置变量将具有特殊的含义：<ul>
<li>$1、$2、$3…：传递给函数的第一个参数保存在$1中，第二个参数保存在$2中，以此类推</li>
<li>$@、$*：保存所有参数，各参数使用空格分隔<ul>
<li>不用双引号包围时，两者没区别</li>
<li>使用双引号包围时，$@的各个元素都被双引号包围，$*的所有元素一次性被双引号包围</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>local</strong>在函数里定义局部变量</p>
<p><strong>return</strong>语句可以来定义函数的返回值</p>
<h2 id="实践：分析一段Shell脚本"><a href="#实践：分析一段Shell脚本" class="headerlink" title="实践：分析一段Shell脚本"></a>实践：分析一段Shell脚本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"> 1 #!/bin/bash</span><br><span class="line"> 2 #</span><br><span class="line"> 3</span><br><span class="line"> 4 function prepare_check() &#123;</span><br><span class="line"> 5   isRoot=`id -u -n | grep root | wc -l`</span><br><span class="line"> 6   if [ &quot;x$isRoot&quot; != &quot;x1&quot; ]; then</span><br><span class="line"> 7       echo -e &quot;[\033[31m ERROR \033[0m] Please use root to execute the installation script (请用 root 用户执行安装脚本)&quot;</span><br><span class="line"> 8       exit 1</span><br><span class="line"> 9   fi</span><br><span class="line">10   processor=`cat /proc/cpuinfo| grep &quot;processor&quot;| wc -l`</span><br><span class="line">11   if [ $processor -lt 2 ]; then</span><br><span class="line">12       echo -e &quot;[\033[31m ERROR \033[0m] The CPU is less than 2 cores (CPU 小于 2核，JumpServer 所在机器的 CPU 需要至少 2核)&quot;</span><br><span class="line">13       exit 1</span><br><span class="line">14   fi</span><br><span class="line">15   memTotal=`cat /proc/meminfo | grep MemTotal | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">16   if [ $memTotal -lt 3750000 ]; then</span><br><span class="line">17       echo -e &quot;[\033[31m ERROR \033[0m] Memory less than 4G (内存小于 4G，JumpServer 所在机器的内存需要至少 4G)&quot;</span><br><span class="line">18       exit 1</span><br><span class="line">19   fi</span><br><span class="line">20 &#125;</span><br><span class="line">21</span><br><span class="line">22 function install_soft() &#123;</span><br><span class="line">23     if command -v dnf &gt; /dev/null; then</span><br><span class="line">24       if [ &quot;$1&quot; == &quot;python&quot; ]; then</span><br><span class="line">25         dnf -q -y install python2</span><br><span class="line">26         ln -s /usr/bin/python2 /usr/bin/python</span><br><span class="line">27       else</span><br><span class="line">28         dnf -q -y install $1</span><br><span class="line">29       fi</span><br><span class="line">30     elif command -v yum &gt; /dev/null; then</span><br><span class="line">31       yum -q -y install $1</span><br><span class="line">32     elif command -v apt &gt; /dev/null; then</span><br><span class="line">33       apt-get -qqy install $1</span><br><span class="line">34     elif command -v zypper &gt; /dev/null; then</span><br><span class="line">35       zypper -q -n install $1</span><br><span class="line">36     elif command -v apk &gt; /dev/null; then</span><br><span class="line">37       apk add -q $1</span><br><span class="line">38     else</span><br><span class="line">39       echo -e &quot;[\033[31m ERROR \033[0m] Please install it first (请先安装) $1 &quot;</span><br><span class="line">40       exit 1</span><br><span class="line">41     fi</span><br><span class="line">42 &#125;</span><br><span class="line">43</span><br><span class="line">44 function prepare_install() &#123;</span><br><span class="line">45   for i in curl wget zip python; do</span><br><span class="line">46     command -v $i &amp;&gt;/dev/null || install_soft $i</span><br><span class="line">47   done</span><br><span class="line">48 &#125;</span><br><span class="line">49</span><br><span class="line">50 function get_installer() &#123;</span><br><span class="line">51   echo &quot;download install script to /opt/jumpserver-installe (开始下载安装脚本到 /opt/jumpserver-installe)&quot;</span><br><span class="line">52   Version=$(curl -s &#x27;https://api.github.com/repos/jumpserver/installer/releases/latest&#x27; | grep &quot;tag_name&quot; | head -n 1 | awk -F &quot;:&quot; &#x27;&#123;print $2&#125;&#x27; | sed &#x27;s/\&quot;//g;s/,//g;s/ //g&#x27;)</span><br><span class="line">53   if [ ! &quot;$Version&quot; ]; then</span><br><span class="line">54     echo -e &quot;[\033[31m ERROR \033[0m] Network Failed (请检查网络是否正常或尝试重新执行脚本)&quot;</span><br><span class="line">55   fi</span><br><span class="line">56   cd /opt</span><br><span class="line">57   if [ ! -d &quot;/opt/jumpserver-installer-$Version&quot; ]; then</span><br><span class="line">58     wget -qO jumpserver-installer-$Version.tar.gz https://github.com/jumpserver/installer/releases/download/$Version/jumpserver-installer-$Version.tar.gz || &#123;</span><br><span class="line">59       rm -rf /opt/jumpserver-installer-$Version.tar.gz</span><br><span class="line">60       echo -e &quot;[\033[31m ERROR \033[0m] Failed to download jumpserver-installer (下载 jumpserver-installer 失败, 请检查网络是否正常或尝试重新执行脚本)&quot;</span><br><span class="line">61       exit 1</span><br><span class="line">62     &#125;</span><br><span class="line">63     tar -xf /opt/jumpserver-installer-$Version.tar.gz -C /opt || &#123;</span><br><span class="line">64       rm -rf /opt/jumpserver-installer-$Version</span><br><span class="line">65       echo -e &quot;[\033[31m ERROR \033[0m] Failed to unzip jumpserver-installe (解压 jumpserver-installer 失败, 请检查网络是否正常或尝试重新执行脚本)&quot;</span><br><span class="line">66       exit 1</span><br><span class="line">67     &#125;</span><br><span class="line">68     rm -rf /opt/jumpserver-installer-$Version.tar.gz</span><br><span class="line">69   fi</span><br><span class="line">70 &#125;</span><br><span class="line">71</span><br><span class="line">72 function config_installer() &#123;</span><br><span class="line">73   cd /opt/jumpserver-installer-$Version</span><br><span class="line">74   JMS_Version=$(curl -s &#x27;https://api.github.com/repos/jumpserver/jumpserver/releases/latest&#x27; | grep &quot;tag_name&quot; | head -n 1 | awk -F &quot;:&quot; &#x27;&#123;print $2&#125;&#x27; | sed &#x27;s/\&quot;//g;s/,//g;s/ //g&#x27;)</span><br><span class="line">75   if [ ! &quot;$JMS_Version&quot; ]; then</span><br><span class="line">76     echo -e &quot;[\033[31m ERROR \033[0m] Network Failed (请检查网络是否正常或尝试重新执行脚本)&quot;</span><br><span class="line">77     exit 1</span><br><span class="line">78   fi</span><br><span class="line">79   sed -i &quot;s/VERSION=.*/VERSION=$JMS_Version/g&quot; /opt/jumpserver-installer-$Version/static.env</span><br><span class="line">80   ./jmsctl.sh install</span><br><span class="line">81 &#125;</span><br><span class="line">82</span><br><span class="line">83 function main()&#123;</span><br><span class="line">84   prepare_check</span><br><span class="line">85   prepare_install</span><br><span class="line">86   get_installer</span><br><span class="line">87   config_installer</span><br><span class="line">88 &#125;</span><br><span class="line">89</span><br><span class="line">90 main              </span><br></pre></td></tr></table></figure>

<blockquote>
<p>分析</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">不要被那么多代码量给吓到了，我们慢慢来分析</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">先了解整个shell的框架如下，</span></span><br><span class="line">&quot;定义的函数不会直接运行，必须通过函数名去调用才会执行&quot;</span><br><span class="line">prepare_check() &#123;</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">定义prepare_check函数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">install_soft() &#123;</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">定义install_soft函数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">prepare_install() &#123;</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">定义prepare_install函数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">get_installer() &#123;</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">定义get_installer函数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">config_installer() &#123;</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">定义config_installer函数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main() &#123;</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">定义主函数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main #执行主函数</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们了解到这段shell脚本有6个函数</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">shell一开始运行并不会直接执行某个函数，只是定义了一个函数告诉系统有这么个名字为***的函数</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用函数名进行调用，才会运行函数体里面的语句！</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们从大概的结构看，最后一行对main主函数进行了调用，也就是运行main主函数，我们来分析以下主函数里面做了什么？</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>主函数</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">   prepare_check	#第一步：调用prepare_check函数</span><br><span class="line">   prepare_install	#第二步：调用prepare_install函数</span><br><span class="line">   get_installer	#第三步：调用get_installer函数</span><br><span class="line">   config_installer	#第四步：调用config_installer函数</span><br><span class="line"> &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">主函数main函数体内对4个自定义函数进行了调用，当调用prepare_check函数则程序会跳转到prepare_check函数体内执行此函数体内的代码</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">接下来我们分析prepare_check函数</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>prepare_check函数</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">function prepare_check() &#123;</span><br><span class="line">  isRoot=`id -u -n | grep root | wc -l`</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">执行命令<span class="built_in">id</span> -u -n | grep root | <span class="built_in">wc</span> -l并将返回值赋值给isRoot变量</span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">判断当前用户是否为root用户并对输出的结果计数</span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">如果是root用户则为1否则为0</span></span><br><span class="line">  </span><br><span class="line">  if [ &quot;x$isRoot&quot; != &quot;x1&quot; ]; then	#条件判断，这里的$isRoot为调用变量，如果x$isRoot不等于&quot;x1&quot;</span><br><span class="line">  	  #如果满足上面的条件则执行下面两条语句</span><br><span class="line">  	  #输出：请用 root 用户执行安装脚本的提示</span><br><span class="line">  	  #-e选项是激活转义字符 “\”表示转义   [\033[31m ERROR \033[0m] 表示ERROR用红色显示</span><br><span class="line">      echo -e &quot;[\033[31m ERROR \033[0m] Please use root to execute the installation script (请用 root 用户执行安装脚本)&quot;</span><br><span class="line">      #exit为退出</span><br><span class="line">      exit 1</span><br><span class="line">  fi</span><br><span class="line">  </span><br><span class="line">  processor=`cat /proc/cpuinfo| grep &quot;processor&quot;| wc -l`</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">执行命令<span class="built_in">cat</span> /proc/cpuinfo | grep <span class="string">&quot;processor&quot;</span> | <span class="built_in">wc</span> -l 对/proc/cpuinfo文件的processor的字段进行计数并将结果赋值给processor变量</span></span><br><span class="line">  </span><br><span class="line">  if [ $processor -lt 2 ]; then		#条件判断，如果processor变量的值小于2</span><br><span class="line">  	  #输出：CPU 小于 2核，JumpServer 所在机器的 CPU 需要至少 2核</span><br><span class="line">      echo -e &quot;[\033[31m ERROR \033[0m] The CPU is less than 2 cores (CPU 小于 2核，JumpServer 所在机器的 CPU 需要至少 2核)&quot;</span><br><span class="line">      #退出shell</span><br><span class="line">      exit 1</span><br><span class="line">  fi</span><br><span class="line"></span><br><span class="line">  memTotal=`cat /proc/meminfo | grep MemTotal | awk &#x27;&#123;print $2&#125;&#x27;`	#输出/proc/meminfo文件的MemTotal字段的第二列的结果赋值给memTotal变量</span><br><span class="line">  </span><br><span class="line">  if [ $memTotal -lt 3750000 ]; then	#判断memTotal变量的值是否小于3750000</span><br><span class="line">  	  #输出：内存小于 4G，JumpServer 所在机器的内存需要至少 4G</span><br><span class="line">      echo -e &quot;[\033[31m ERROR \033[0m] Memory less than 4G (内存小于 4G，JumpServer 所在机器的内存需要至少 4G)&quot;</span><br><span class="line">      #退出shell</span><br><span class="line">      exit 1</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">prepare_check函数主要用来判断主机的CPU、内存、用户是否都满足条件，如果不满足则退出shell脚本</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果满足我们则执行main函数的第二条语句</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">看下面</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>主函数</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">   prepare_check	#这步已经执行完毕，主机各项配置都符合条件，接下来执行下面那条语句；如果第一个函数其中一项不满足条件，整个shell进行退出，不会再执行下面的语句了。    </span><br><span class="line">   prepare_install	#第二步：调用prepare_install函数</span><br><span class="line">   get_installer	#第三步：调用get_installer函数</span><br><span class="line">   config_installer	#第四步：调用config_installer函数</span><br><span class="line"> &#125;</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下面进入prepare_install函数</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>prepare_install函数</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function prepare_install() &#123;</span><br><span class="line">  for i in curl wget zip python; do		</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">使用<span class="keyword">for</span>循环进行迭代，<span class="keyword">for</span>循环共会执行4次，每次的i变量的参数为curl、wget、zip、python</span></span><br><span class="line">    command -v $i &amp;&gt;/dev/null || install_soft $i</span><br><span class="line">    #使用command -v 命令判断i变量中的参数(也就是判断系统有没有这个命令)，如果有，则开始下一轮循环，如果没有则调用install_soft函数并传递变量i的值，并进行相应命令的安装</span><br><span class="line">  done</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">本函数用来判断Linux系统中是否存在curl、wget、zip、python这四条命令，如果都有，则本函数执行完毕！如果没有则将没有的命令通过变量i传递至install_soft函数</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">接下来我们看install_soft函数</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>install_soft函数</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">function install_soft() &#123;</span><br><span class="line">    if command -v dnf &gt; /dev/null; then		#判断系统是否有dnf命令</span><br><span class="line">      if [ &quot;$1&quot; == &quot;python&quot; ]; then		#判断$1为 调用函数时传递进来的参数 也就是没有前面没有安装的命令 判断是否为python</span><br><span class="line">        dnf -q -y install python2		#安装python2</span><br><span class="line">        ln -s /usr/bin/python2 /usr/bin/python	#对python2命令进行软链接</span><br><span class="line">      else</span><br><span class="line">        dnf -q -y install $1	#如果不等于python则安装$1 也就是传递进来的参数(命令)</span><br><span class="line">      fi</span><br><span class="line">    elif command -v yum &gt; /dev/null; then	#判断系统是否有yum命令</span><br><span class="line">      yum -q -y install $1		#安装$1变量里的命令</span><br><span class="line">    elif command -v apt &gt; /dev/null; then	#判断系统是否有apt命令</span><br><span class="line">      apt-get -qqy install $1	#安装$1变量里的命令</span><br><span class="line">    elif command -v zypper &gt; /dev/null; then	#判断系统是否有zypper命令</span><br><span class="line">      zypper -q -n install $1	#安装$1变量里的命令</span><br><span class="line">    elif command -v apk &gt; /dev/null; then	#判断系统是否有apk命令</span><br><span class="line">      apk add -q $1		#安装$1变量里的命令</span><br><span class="line">    else</span><br><span class="line">      echo -e &quot;[\033[31m ERROR \033[0m] Please install it first (请先安装) $1 &quot;		#如果以上方法都无法进行安装，则输出：...请安装**</span><br><span class="line">      #退出shell</span><br><span class="line">      exit 1</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">回到prepare_install函数</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>prepare_install函数</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function prepare_install() &#123;</span><br><span class="line">  for i in curl wget zip python; do		</span><br><span class="line">    command -v $i &amp;&gt;/dev/null || install_soft $i</span><br><span class="line">  done</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">通过prepare_install函数和install_soft的判断和安装</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们可以确定系统已经有curl wget zip python等4条命令了，如果正常执行完install_soft函数体里的命令(不正常情况shell已退出)，则回到main主函数</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>主函数</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">   prepare_check	#这步已经执行完毕，主机各项配置都符合条件，接下来执行下面那条语句；如果第一个函数其中一项不满足条件，整个shell进行退出，不会再执行下面的语句了。    </span><br><span class="line">   prepare_install	#这部已经执行完毕，主机必要的命令已存在</span><br><span class="line">   get_installer	#第三步：调用get_installer函数</span><br><span class="line">   config_installer	#第四步：调用config_installer函数</span><br><span class="line"> &#125;</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下面进入get_isntaller函数</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>get_installer函数</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">function get_installer() &#123;</span><br><span class="line">  echo &quot;download install script to /opt/jumpserver-installe (开始下载安装脚本到 /opt/jumpserver-installe)&quot;</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">输出：开始下载安装脚本...</span></span><br><span class="line">  </span><br><span class="line">  Version=$(curl -s &#x27;https://api.github.com/repos/jumpserver/installer/releases/latest&#x27; | grep &quot;tag_name&quot; | head -n 1 | awk -F &quot;:&quot; &#x27;&#123;print $2&#125;&#x27; | sed &#x27;s/\&quot;//g;s/,//g;s/ //g&#x27;)</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">对链接的信息进行筛选，找到<span class="string">&quot;tag-name&quot;</span>字符的第一行，并对接下来的结果筛选，并将结果赋值给Version变量</span></span><br><span class="line">  if [ ! &quot;$Version&quot; ]; then		# 取反</span><br><span class="line">    echo -e &quot;[\033[31m ERROR \033[0m] Network Failed (请检查网络是否正常或尝试重新执行脚本)&quot;</span><br><span class="line">  fi</span><br><span class="line">  cd /opt	#进入/opt目录</span><br><span class="line">  </span><br><span class="line">  if [ ! -d &quot;/opt/jumpserver-installer-$Version&quot; ]; then	#判断这个目录是否存在，并取反</span><br><span class="line"><span class="meta prompt_">  	#</span><span class="language-bash">如果不存在，则开始下载相应的文件，如果下载不成功，删除下载的文件，并提示检查网络是否正常</span></span><br><span class="line">    wget -qO jumpserver-installer-$Version.tar.gz https://github.com/jumpserver/installer/releases/download/$Version/jumpserver-installer-$Version.tar.gz || &#123;</span><br><span class="line">      rm -rf /opt/jumpserver-installer-$Version.tar.gz</span><br><span class="line">      echo -e &quot;[\033[31m ERROR \033[0m] Failed to download jumpserver-installer (下载 jumpserver-installer 失败, 请检查&gt;网络是否正常或尝试重新执行脚本)&quot;</span><br><span class="line">      exit 1</span><br><span class="line">    &#125;</span><br><span class="line">    #	下载成功后对文件进行解压缩 || 前者不成功则进行删除相应的目录并提示：网络问题或重新执行脚本并退出</span><br><span class="line">    tar -xf /opt/jumpserver-installer-$Version.tar.gz -C /opt || &#123;</span><br><span class="line">      rm -rf /opt/jumpserver-installer-$Version</span><br><span class="line">      echo -e &quot;[\033[31m ERROR \033[0m] Failed to unzip jumpserver-installe (解压 jumpserver-installer 失败, 请检查网络&gt;是否正常或尝试重新执行脚本)&quot;</span><br><span class="line">      exit 1</span><br><span class="line">    &#125;</span><br><span class="line">    #	如果成功解压后，删除下载的压缩包</span><br><span class="line">    rm -rf /opt/jumpserver-installer-$Version.tar.gz</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">成功执行完毕返回main主函数</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>主函数</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">   prepare_check	#这步已经执行完毕，主机各项配置都符合条件，接下来执行下面那条语句；如果第一个函数其中一项不满足条件，整个shell进行退出，不会再执行下面的语句了。    </span><br><span class="line">   prepare_install	#这部已经执行完毕，主机必要的命令已存在</span><br><span class="line">   get_installer	#这部已经执行完毕，相应的文件已下载并解压</span><br><span class="line">   config_installer	#第四步：调用config_installer函数</span><br><span class="line"> &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下面进入config_installer函数</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>config_installer函数</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function config_installer() &#123;</span><br><span class="line">  cd /opt/jumpserver-installer-$Version</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">	进入相应的目录</span></span><br><span class="line">  </span><br><span class="line">  JMS_Version=$(curl -s &#x27;https://api.github.com/repos/jumpserver/jumpserver/releases/latest&#x27; | grep &quot;tag_name&quot; | head -n 1 | awk -F &quot;:&quot; &#x27;&#123;print $2&#125;&#x27; | sed &#x27;s/\&quot;//g;s/,//g;s/ //g&#x27;)</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">将链接的信息进行筛选并赋值给JMS_Version变量</span></span><br><span class="line">  </span><br><span class="line">  if [ ! &quot;$JMS_Version&quot; ]; then		#取反</span><br><span class="line"><span class="meta prompt_">  	#</span><span class="language-bash">如果为假 则提示：检查网络或重新执行脚本，并退出</span></span><br><span class="line">    echo -e &quot;[\033[31m ERROR \033[0m] Network Failed (请检查网络是否正常或尝试重新执行脚本)&quot;</span><br><span class="line">    exit 1</span><br><span class="line">  fi</span><br><span class="line">  </span><br><span class="line">  sed -i &quot;s/VERSION=.*/VERSION=$JMS_Version/g&quot; /opt/jumpserver-installer-$Version/static.env</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">在/opt/jumpserver-installer-<span class="variable">$Version</span>/static.env文件中插入s/VERSION=.*/VERSION=<span class="variable">$JMS_Version</span>/g参数</span></span><br><span class="line">  ./jmsctl.sh install</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">运行脚本</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">config_installer函数执行完毕，返回主函数main</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>主函数</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">   prepare_check	#这步已经执行完毕，主机各项配置都符合条件，接下来执行下面那条语句；如果第一个函数其中一项不满足条件，整个shell进行退出，不会再执行下面的语句了。    </span><br><span class="line">   prepare_install	#这部已经执行完毕，主机必要的命令已存在</span><br><span class="line">   get_installer	#这部已经执行完毕，相应的文件已下载并解压</span><br><span class="line">   config_installer	#这部已经执行完毕，已配置完毕相应的配置并运行jumpserver</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">---------------------- 至此shell分析结束，如果有不到位的请留言提出qwq或私信我--------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 除了某些命令可能不是很了解，其实看完前面的基础和掌握Linux基础命令，对上面的shell也能大致的进行分析了</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 接下来就是多多练习了~</span></span></span><br><span class="line"><span class="meta prompt_">#</span></span><br></pre></td></tr></table></figure>



<h1 id="记一次MySQL-Shell学习"><a href="#记一次MySQL-Shell学习" class="headerlink" title="记一次MySQL-Shell学习"></a>记一次MySQL-Shell学习</h1><h2 id="日志记录函数"><a href="#日志记录函数" class="headerlink" title="日志记录函数"></a>日志记录函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql_log() &#123;</span><br><span class="line">        local type=&quot;$1&quot;; shift</span><br><span class="line">        local text=&quot;$*&quot;; if [ &quot;$#&quot; -eq 0 ]; then text=&quot;$(cat)&quot;; fi</span><br><span class="line">        local dt; dt=&quot;$(date --rfc-3339=seconds)&quot;</span><br><span class="line">        printf &#x27;%s [%s] [Entrypoint]: %s\n&#x27; &quot;$dt&quot; &quot;$type&quot; &quot;$text&quot;</span><br><span class="line">&#125;</span><br><span class="line">mysql_note() &#123;</span><br><span class="line">        mysql_log Note &quot;$@&quot;</span><br><span class="line">&#125;</span><br><span class="line">mysql_warn() &#123;</span><br><span class="line">        mysql_log Warn &quot;$@&quot; &gt;&amp;2</span><br><span class="line">&#125;</span><br><span class="line">mysql_error() &#123;</span><br><span class="line">        mysql_log ERROR &quot;$@&quot; &gt;&amp;2</span><br><span class="line">        exit 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="文件变量函数"><a href="#文件变量函数" class="headerlink" title="文件变量函数"></a>文件变量函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">file_env() &#123;</span><br><span class="line">        local var=&quot;$1&quot;</span><br><span class="line">        local fileVar=&quot;$&#123;var&#125;_FILE&quot;</span><br><span class="line">        local def=&quot;$&#123;2:-&#125;&quot;</span><br><span class="line">        if [ &quot;$&#123;!var:-&#125;&quot; ] &amp;&amp; [ &quot;$&#123;!fileVar:-&#125;&quot; ]; then</span><br><span class="line">                mysql_error &quot;Both $var and $fileVar are set (but are exclusive)&quot;</span><br><span class="line">        fi</span><br><span class="line">        local val=&quot;$def&quot;</span><br><span class="line">        if [ &quot;$&#123;!var:-&#125;&quot; ]; then</span><br><span class="line">                val=&quot;$&#123;!var&#125;&quot;</span><br><span class="line">        elif [ &quot;$&#123;!fileVar:-&#125;&quot; ]; then</span><br><span class="line">                val=&quot;$(&lt; &quot;$&#123;!fileVar&#125;&quot;)&quot;</span><br><span class="line">        fi</span><br><span class="line">        export &quot;$var&quot;=&quot;$val&quot;</span><br><span class="line">        unset &quot;$fileVar&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="检测文件本身函数"><a href="#检测文件本身函数" class="headerlink" title="检测文件本身函数"></a>检测文件本身函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_is_sourced() &#123;</span><br><span class="line">        [ &quot;$&#123;#FUNCNAME[@]&#125;&quot; -ge 2 ] \</span><br><span class="line">                &amp;&amp; [ &quot;$&#123;FUNCNAME[0]&#125;&quot; = &#x27;_is_sourced&#x27; ] \</span><br><span class="line">                &amp;&amp; [ &quot;$&#123;FUNCNAME[1]&#125;&quot; = &#x27;source&#x27; ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="进程初始化文件函数"><a href="#进程初始化文件函数" class="headerlink" title="进程初始化文件函数"></a>进程初始化文件函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">docker_process_init_files() &#123;</span><br><span class="line">        mysql=( docker_process_sql )</span><br><span class="line"></span><br><span class="line">        echo</span><br><span class="line">        local f</span><br><span class="line">        for f; do</span><br><span class="line">                case &quot;$f&quot; in</span><br><span class="line">                        *.sh)</span><br><span class="line">                                if [ -x &quot;$f&quot; ]; then</span><br><span class="line">                                        mysql_note &quot;$0: running $f&quot;</span><br><span class="line">                                        &quot;$f&quot;</span><br><span class="line">                                else</span><br><span class="line">                                        mysql_note &quot;$0: sourcing $f&quot;</span><br><span class="line">                                        . &quot;$f&quot;</span><br><span class="line">                                fi</span><br><span class="line">                                ;;</span><br><span class="line">                        *.sql)     mysql_note &quot;$0: running $f&quot;; docker_process_sql &lt; &quot;$f&quot;; echo ;;</span><br><span class="line">                        *.sql.bz2) mysql_note &quot;$0: running $f&quot;; bunzip2 -c &quot;$f&quot; | docker_process_sql; echo ;;</span><br><span class="line">                        *.sql.gz)  mysql_note &quot;$0: running $f&quot;; gunzip -c &quot;$f&quot; | docker_process_sql; echo ;;</span><br><span class="line">                        *.sql.xz)  mysql_note &quot;$0: running $f&quot;; xzcat &quot;$f&quot; | docker_process_sql; echo ;;</span><br><span class="line">                        *.sql.zst) mysql_note &quot;$0: running $f&quot;; zstd -dc &quot;$f&quot; | docker_process_sql; echo ;;</span><br><span class="line">                        *)         mysql_warn &quot;$0: ignoring $f&quot; ;;</span><br><span class="line">                esac</span><br><span class="line">                echo</span><br><span class="line">        done</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="检测配置函数"><a href="#检测配置函数" class="headerlink" title="检测配置函数"></a>检测配置函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql_check_config() &#123;</span><br><span class="line">        local toRun=( &quot;$@&quot; &quot;$&#123;_verboseHelpArgs[@]&#125;&quot; ) errors</span><br><span class="line">        if ! errors=&quot;$(&quot;$&#123;toRun[@]&#125;&quot; 2&gt;&amp;1 &gt;/dev/null)&quot;; then</span><br><span class="line">                mysql_error $&#x27;mysqld failed while attempting to check config\n\tcommand was: &#x27;&quot;$&#123;toRun[*]&#125;&quot;$&#x27;\n\t&#x27;&quot;$errors&quot;</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="获取配置函数"><a href="#获取配置函数" class="headerlink" title="获取配置函数"></a>获取配置函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql_get_config() &#123;</span><br><span class="line">        local conf=&quot;$1&quot;; shift</span><br><span class="line">        &quot;$@&quot; &quot;$&#123;_verboseHelpArgs[@]&#125;&quot; 2&gt;/dev/null \</span><br><span class="line">                | awk -v conf=&quot;$conf&quot; &#x27;$1 == conf &amp;&amp; /^[^ \t]/ &#123; sub(/^[^ \t]+[ \t]+/, &quot;&quot;); print; exit &#125;&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="套接字函数"><a href="#套接字函数" class="headerlink" title="套接字函数"></a>套接字函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql_socket_fix() &#123;</span><br><span class="line">        local defaultSocket</span><br><span class="line">        defaultSocket=&quot;$(mysql_get_config &#x27;socket&#x27; mysqld --no-defaults)&quot;</span><br><span class="line">        if [ &quot;$defaultSocket&quot; != &quot;$SOCKET&quot; ]; then</span><br><span class="line">                ln -sfTv &quot;$SOCKET&quot; &quot;$defaultSocket&quot; || :</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="临时启动服务函数"><a href="#临时启动服务函数" class="headerlink" title="临时启动服务函数"></a>临时启动服务函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">docker_temp_server_start() &#123;</span><br><span class="line">        if [ &quot;$&#123;MYSQL_MAJOR&#125;&quot; = &#x27;5.7&#x27; ]; then</span><br><span class="line">                &quot;$@&quot; --skip-networking --default-time-zone=SYSTEM --socket=&quot;$&#123;SOCKET&#125;&quot; &amp;</span><br><span class="line">                mysql_note &quot;Waiting for server startup&quot;</span><br><span class="line">                local i</span><br><span class="line">                for i in &#123;30..0&#125;; do</span><br><span class="line">                        # only use the root password if the database has already been initialized</span><br><span class="line">                        # so that it won&#x27;t try to fill in a password file when it hasn&#x27;t been set yet</span><br><span class="line">                        extraArgs=()</span><br><span class="line">                        if [ -z &quot;$DATABASE_ALREADY_EXISTS&quot; ]; then</span><br><span class="line">                                extraArgs+=( &#x27;--dont-use-mysql-root-password&#x27; )</span><br><span class="line">                        fi</span><br><span class="line">                        if docker_process_sql &quot;$&#123;extraArgs[@]&#125;&quot; --database=mysql &lt;&lt;&lt;&#x27;SELECT 1&#x27; &amp;&gt; /dev/null; then</span><br><span class="line">                                break</span><br><span class="line">                        fi</span><br><span class="line">                        sleep 1</span><br><span class="line">                done</span><br><span class="line">                if [ &quot;$i&quot; = 0 ]; then</span><br><span class="line">                        mysql_error &quot;Unable to start server.&quot;</span><br><span class="line">                fi</span><br><span class="line">        else</span><br><span class="line">                # For 5.7+ the server is ready for use as soon as startup command unblocks</span><br><span class="line">                if ! &quot;$@&quot; --daemonize --skip-networking --default-time-zone=SYSTEM --socket=&quot;$&#123;SOCKET&#125;&quot;; then</span><br><span class="line">                        mysql_error &quot;Unable to start server.&quot;</span><br><span class="line">                fi</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="停止临时服务函数"><a href="#停止临时服务函数" class="headerlink" title="停止临时服务函数"></a>停止临时服务函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker_temp_server_stop() &#123;</span><br><span class="line">        if ! mysqladmin --defaults-extra-file=&lt;( _mysql_passfile ) shutdown -uroot --socket=&quot;$&#123;SOCKET&#125;&quot;; then</span><br><span class="line">                mysql_error &quot;Unable to shut down server.&quot;</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="检查密码函数"><a href="#检查密码函数" class="headerlink" title="检查密码函数"></a>检查密码函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">docker_verify_minimum_env() &#123;</span><br><span class="line">        if [ -z &quot;$MYSQL_ROOT_PASSWORD&quot; -a -z &quot;$MYSQL_ALLOW_EMPTY_PASSWORD&quot; -a -z &quot;$MYSQL_RANDOM_ROOT_PASSWORD&quot; ]; then</span><br><span class="line">                mysql_error &lt;&lt; -&#x27;EOF&#x27;</span><br><span class="line">                        Database is uninitialized and password option is not specified</span><br><span class="line">                            You need to specify one of the following as an environment variable:</span><br><span class="line">                            - MYSQL_ROOT_PASSWORD</span><br><span class="line">                            - MYSQL_ALLOW_EMPTY_PASSWORD</span><br><span class="line">                            - MYSQL_RANDOM_ROOT_PASSWORD</span><br><span class="line">                </span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        # This will prevent the CREATE USER from failing (and thus exiting with a half-initialized database)</span><br><span class="line">        if [ &quot;$MYSQL_USER&quot; = &#x27;root&#x27; ]; then</span><br><span class="line">                mysql_error &lt;&lt; -&#x27;EOF&#x27;</span><br><span class="line">                        MYSQL_USER=&quot;root&quot;, MYSQL_USER and MYSQL_PASSWORD are for configuring a regular user and cannot be used for the root user</span><br><span class="line">                            Remove MYSQL_USER=&quot;root&quot; and use one of the following to control the root user password:</span><br><span class="line">                            - MYSQL_ROOT_PASSWORD</span><br><span class="line">                            - MYSQL_ALLOW_EMPTY_PASSWORD</span><br><span class="line">                            - MYSQL_RANDOM_ROOT_PASSWORD</span><br><span class="line">                EOF</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        # warn when missing one of MYSQL_USER or MYSQL_PASSWORD</span><br><span class="line">        if [ -n &quot;$MYSQL_USER&quot; ] &amp;&amp; [ -z &quot;$MYSQL_PASSWORD&quot; ]; then</span><br><span class="line">                mysql_warn &#x27;MYSQL_USER specified, but missing MYSQL_PASSWORD; MYSQL_USER will not be created&#x27;</span><br><span class="line">        elif [ -z &quot;$MYSQL_USER&quot; ] &amp;&amp; [ -n &quot;$MYSQL_PASSWORD&quot; ]; then</span><br><span class="line">                mysql_warn &#x27;MYSQL_PASSWORD specified, but missing MYSQL_USER; MYSQL_PASSWORD will be ignored&#x27;</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建数据库文件函数"><a href="#创建数据库文件函数" class="headerlink" title="创建数据库文件函数"></a>创建数据库文件函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">docker_create_db_directories() &#123;</span><br><span class="line">        local user; user=&quot;$(id -u)&quot;</span><br><span class="line"></span><br><span class="line">        local -A dirs=( [&quot;$DATADIR&quot;]=1 )</span><br><span class="line">        local dir</span><br><span class="line">        dir=&quot;$(dirname &quot;$SOCKET&quot;)&quot;</span><br><span class="line">        dirs[&quot;$dir&quot;]=1</span><br><span class="line"></span><br><span class="line">        # &quot;datadir&quot; and &quot;socket&quot; are already handled above (since they were already queried previously)</span><br><span class="line">        local conf</span><br><span class="line">        for conf in \</span><br><span class="line">                general-log-file \</span><br><span class="line">                keyring_file_data \</span><br><span class="line">                pid-file \</span><br><span class="line">                secure-file-priv \</span><br><span class="line">                slow-query-log-file \</span><br><span class="line">        ; do</span><br><span class="line">                dir=&quot;$(mysql_get_config &quot;$conf&quot; &quot;$@&quot;)&quot;</span><br><span class="line"></span><br><span class="line">                # skip empty values</span><br><span class="line">                if [ -z &quot;$dir&quot; ] || [ &quot;$dir&quot; = &#x27;NULL&#x27; ]; then</span><br><span class="line">                        continue</span><br><span class="line">                fi</span><br><span class="line">                case &quot;$conf&quot; in</span><br><span class="line">                        secure-file-priv)</span><br><span class="line">                                # already points at a directory</span><br><span class="line">                                ;;</span><br><span class="line">                        *)</span><br><span class="line">                                # other config options point at a file, but we need the directory</span><br><span class="line">                                dir=&quot;$(dirname &quot;$dir&quot;)&quot;</span><br><span class="line">                                ;;</span><br><span class="line">                esac</span><br><span class="line"></span><br><span class="line">                dirs[&quot;$dir&quot;]=1</span><br><span class="line">        done</span><br><span class="line"></span><br><span class="line">        mkdir -p &quot;$&#123;!dirs[@]&#125;&quot;</span><br><span class="line"></span><br><span class="line">        if [ &quot;$user&quot; = &quot;0&quot; ]; then</span><br><span class="line">                # this will cause less disk access than `chown -R`</span><br><span class="line">                find &quot;$&#123;!dirs[@]&#125;&quot; \! -user mysql -exec chown --no-dereference mysql &#x27;&#123;&#125;&#x27; +</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="初始化数据库目录函数"><a href="#初始化数据库目录函数" class="headerlink" title="初始化数据库目录函数"></a>初始化数据库目录函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker_init_database_dir() &#123;</span><br><span class="line">        mysql_note &quot;Initializing database files&quot;</span><br><span class="line">        &quot;$@&quot; --initialize-insecure --default-time-zone=SYSTEM</span><br><span class="line">        mysql_note &quot;Database files initialized&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">docker_setup_env() &#123;</span><br><span class="line">        # Get config</span><br><span class="line">        declare -g DATADIR SOCKET</span><br><span class="line">        DATADIR=&quot;$(mysql_get_config &#x27;datadir&#x27; &quot;$@&quot;)&quot;</span><br><span class="line">        SOCKET=&quot;$(mysql_get_config &#x27;socket&#x27; &quot;$@&quot;)&quot;</span><br><span class="line"></span><br><span class="line">        # Initialize values that might be stored in a file</span><br><span class="line">        file_env &#x27;MYSQL_ROOT_HOST&#x27; &#x27;%&#x27;</span><br><span class="line">        file_env &#x27;MYSQL_DATABASE&#x27;</span><br><span class="line">        file_env &#x27;MYSQL_USER&#x27;</span><br><span class="line">        file_env &#x27;MYSQL_PASSWORD&#x27;</span><br><span class="line">        file_env &#x27;MYSQL_ROOT_PASSWORD&#x27;</span><br><span class="line"></span><br><span class="line">        declare -g DATABASE_ALREADY_EXISTS</span><br><span class="line">        if [ -d &quot;$DATADIR/mysql&quot; ]; then</span><br><span class="line">                DATABASE_ALREADY_EXISTS=&#x27;true&#x27;</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="执行SQL脚本函数"><a href="#执行SQL脚本函数" class="headerlink" title="执行SQL脚本函数"></a>执行SQL脚本函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker_process_sql() &#123;</span><br><span class="line">        passfileArgs=()</span><br><span class="line">        if [ &#x27;--dont-use-mysql-root-password&#x27; = &quot;$1&quot; ]; then</span><br><span class="line">                passfileArgs+=( &quot;$1&quot; )</span><br><span class="line">                shift</span><br><span class="line">        fi</span><br><span class="line">        # args sent in can override this db, since they will be later in the command</span><br><span class="line">        if [ -n &quot;$MYSQL_DATABASE&quot; ]; then</span><br><span class="line">                set -- --database=&quot;$MYSQL_DATABASE&quot; &quot;$@&quot;</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        mysql --defaults-extra-file=&lt;( _mysql_passfile &quot;$&#123;passfileArgs[@]&#125;&quot;) --protocol=socket -uroot -hlocalhost --socket=&quot;$&#123;SOCKET&#125;&quot; --comments &quot;$@&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="初始化数据库函数"><a href="#初始化数据库函数" class="headerlink" title="初始化数据库函数"></a>初始化数据库函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">docker_setup_db() &#123;</span><br><span class="line">        # Load timezone info into database</span><br><span class="line">        if [ -z &quot;$MYSQL_INITDB_SKIP_TZINFO&quot; ]; then</span><br><span class="line">                # sed is for https://bugs.mysql.com/bug.php?id=20545</span><br><span class="line">                mysql_tzinfo_to_sql /usr/share/zoneinfo \</span><br><span class="line">                        | sed &#x27;s/Local time zone must be set--see zic manual page/FCTY/&#x27; \</span><br><span class="line">                        | docker_process_sql --dont-use-mysql-root-password --database=mysql</span><br><span class="line">                        # tell docker_process_sql to not use MYSQL_ROOT_PASSWORD since it is not set yet</span><br><span class="line">        fi</span><br><span class="line">        # Generate random root password</span><br><span class="line">        if [ -n &quot;$MYSQL_RANDOM_ROOT_PASSWORD&quot; ]; then</span><br><span class="line">                MYSQL_ROOT_PASSWORD=&quot;$(openssl rand -base64 24)&quot;; export MYSQL_ROOT_PASSWORD</span><br><span class="line">                mysql_note &quot;GENERATED ROOT PASSWORD: $MYSQL_ROOT_PASSWORD&quot;</span><br><span class="line">        fi</span><br><span class="line">        # Sets root password and creates root users for non-localhost hosts</span><br><span class="line">        local rootCreate=</span><br><span class="line">        # default root to listen for connections from anywhere</span><br><span class="line">        if [ -n &quot;$MYSQL_ROOT_HOST&quot; ] &amp;&amp; [ &quot;$MYSQL_ROOT_HOST&quot; != &#x27;localhost&#x27; ]; then</span><br><span class="line">                # no, we don&#x27;t care if read finds a terminating character in this heredoc</span><br><span class="line">                # https://unix.stackexchange.com/questions/265149/why-is-set-o-errexit-breaking-this-read-heredoc-expression/265151#265151</span><br><span class="line">                ## read -r -d &#x27;&#x27; rootCreate &lt;&lt;-EOSQL || true</span><br><span class="line">                        CREATE USER &#x27;root&#x27;@&#x27;$&#123;MYSQL_ROOT_HOST&#125;&#x27; IDENTIFIED BY &#x27;$&#123;MYSQL_ROOT_PASSWORD&#125;&#x27; ;</span><br><span class="line">                        GRANT ALL ON *.* TO &#x27;root&#x27;@&#x27;$&#123;MYSQL_ROOT_HOST&#125;&#x27; WITH GRANT OPTION ;</span><br><span class="line">                EOSQL</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        local passwordSet=</span><br><span class="line">        # no, we don&#x27;t care if read finds a terminating character in this heredoc (see above)</span><br><span class="line">        #read -r -d &#x27;&#x27; passwordSet &lt;&lt;-EOSQL || true</span><br><span class="line">                ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;$&#123;MYSQL_ROOT_PASSWORD&#125;&#x27; ;</span><br><span class="line">        EOSQL</span><br><span class="line"></span><br><span class="line">        # tell docker_process_sql to not use MYSQL_ROOT_PASSWORD since it is just now being set</span><br><span class="line">        docker_process_sql --dont-use-mysql-root-password --database=mysql &lt;&lt;-EOSQL</span><br><span class="line">                -- What&#x27;s done in this file shouldn&#x27;t be replicated</span><br><span class="line">                --  or products like mysql-fabric won&#x27;t work</span><br><span class="line">                SET @@SESSION.SQL_LOG_BIN=0;</span><br><span class="line"></span><br><span class="line">                $&#123;passwordSet&#125;</span><br><span class="line">                GRANT ALL ON *.* TO &#x27;root&#x27;@&#x27;localhost&#x27; WITH GRANT OPTION ;</span><br><span class="line">                FLUSH PRIVILEGES ;</span><br><span class="line">                $&#123;rootCreate&#125;</span><br><span class="line">                DROP DATABASE IF EXISTS test ;</span><br><span class="line">        EOSQL</span><br><span class="line"></span><br><span class="line">        # Creates a custom database and user if specified</span><br><span class="line">        if [ -n &quot;$MYSQL_DATABASE&quot; ]; then</span><br><span class="line">                mysql_note &quot;Creating database $&#123;MYSQL_DATABASE&#125;&quot;</span><br><span class="line">                docker_process_sql --database=mysql &lt;&lt;&lt;&quot;CREATE DATABASE IF NOT EXISTS \`$MYSQL_DATABASE\` ;&quot;</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        if [ -n &quot;$MYSQL_USER&quot; ] &amp;&amp; [ -n &quot;$MYSQL_PASSWORD&quot; ]; then</span><br><span class="line">                mysql_note &quot;Creating user $&#123;MYSQL_USER&#125;&quot;</span><br><span class="line">                docker_process_sql --database=mysql &lt;&lt;&lt;&quot;CREATE USER &#x27;$MYSQL_USER&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;$MYSQL_PASSWORD&#x27; ;&quot;</span><br><span class="line"></span><br><span class="line">                if [ -n &quot;$MYSQL_DATABASE&quot; ]; then</span><br><span class="line">                        mysql_note &quot;Giving user $&#123;MYSQL_USER&#125; access to schema $&#123;MYSQL_DATABASE&#125;&quot;</span><br><span class="line">                        docker_process_sql --database=mysql &lt;&lt;&lt;&quot;GRANT ALL ON \`$&#123;MYSQL_DATABASE//_/\\_&#125;\`.* TO &#x27;$MYSQL_USER&#x27;@&#x27;%&#x27; ;&quot;</span><br><span class="line">                fi</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="回显密码函数"><a href="#回显密码函数" class="headerlink" title="回显密码函数"></a>回显密码函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">_mysql_passfile() &#123;</span><br><span class="line">        # echo the password to the &quot;file&quot; the client uses</span><br><span class="line">        # the client command will use process substitution to create a file on the fly</span><br><span class="line">        # ie: --defaults-extra-file=&lt;( _mysql_passfile )</span><br><span class="line">        if [ &#x27;--dont-use-mysql-root-password&#x27; != &quot;$1&quot; ] &amp;&amp; [ -n &quot;$MYSQL_ROOT_PASSWORD&quot; ]; then</span><br><span class="line">                ##cat &lt;&lt;-EOF</span><br><span class="line">                        [client]</span><br><span class="line">                        password=&quot;$&#123;MYSQL_ROOT_PASSWORD&#125;&quot;</span><br><span class="line">                EOF</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="标志ROOT过期函数"><a href="#标志ROOT过期函数" class="headerlink" title="标志ROOT过期函数"></a>标志ROOT过期函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql_expire_root_user() &#123;</span><br><span class="line">        if [ -n &quot;$MYSQL_ONETIME_PASSWORD&quot; ]; then</span><br><span class="line">                ##docker_process_sql --database=mysql &lt;&lt;-EOSQL</span><br><span class="line">                        ALTER USER &#x27;root&#x27;@&#x27;%&#x27; PASSWORD EXPIRE;</span><br><span class="line">                EOSQL</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="检查是否包含导进程停止的参数函数"><a href="#检查是否包含导进程停止的参数函数" class="headerlink" title="检查是否包含导进程停止的参数函数"></a>检查是否包含导进程停止的参数函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">_mysql_want_help() &#123;</span><br><span class="line">        local arg</span><br><span class="line">        for arg; do</span><br><span class="line">                case &quot;$arg&quot; in</span><br><span class="line">                        -&#x27;?&#x27;|--help|--print-defaults|-V|--version)</span><br><span class="line">                                return 0</span><br><span class="line">                                ;;</span><br><span class="line">                esac</span><br><span class="line">        done</span><br><span class="line">        return 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="主函数"><a href="#主函数" class="headerlink" title="主函数"></a>主函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">_main() &#123;</span><br><span class="line">        # if command starts with an option, prepend mysqld</span><br><span class="line">        if [ &quot;$&#123;1:0:1&#125;&quot; = &#x27;-&#x27; ]; then</span><br><span class="line">                set -- mysqld &quot;$@&quot;</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        # skip setup if they aren&#x27;t running mysqld or want an option that stops mysqld</span><br><span class="line">        if [ &quot;$1&quot; = &#x27;mysqld&#x27; ] &amp;&amp; ! _mysql_want_help &quot;$@&quot;; then</span><br><span class="line">                mysql_note &quot;Entrypoint script for MySQL Server $&#123;MYSQL_VERSION&#125; started.&quot;</span><br><span class="line"></span><br><span class="line">                mysql_check_config &quot;$@&quot;</span><br><span class="line">                # Load various environment variables</span><br><span class="line">                docker_setup_env &quot;$@&quot;</span><br><span class="line">                docker_create_db_directories &quot;$@&quot;</span><br><span class="line"></span><br><span class="line">                # If container is started as root user, restart as dedicated mysql user</span><br><span class="line">                if [ &quot;$(id -u)&quot; = &quot;0&quot; ]; then</span><br><span class="line">                        mysql_note &quot;Switching to dedicated user &#x27;mysql&#x27;&quot;</span><br><span class="line">                        exec gosu mysql &quot;$BASH_SOURCE&quot; &quot;$@&quot;</span><br><span class="line">                fi</span><br><span class="line"></span><br><span class="line">                # there&#x27;s no database, so it needs to be initialized</span><br><span class="line">                if [ -z &quot;$DATABASE_ALREADY_EXISTS&quot; ]; then</span><br><span class="line">                        docker_verify_minimum_env</span><br><span class="line"></span><br><span class="line">                        # check dir permissions to reduce likelihood of half-initialized database</span><br><span class="line">                        ls /docker-entrypoint-initdb.d/ &gt; /dev/null</span><br><span class="line"></span><br><span class="line">                        docker_init_database_dir &quot;$@&quot;</span><br><span class="line"></span><br><span class="line">                        mysql_note &quot;Starting temporary server&quot;</span><br><span class="line">                        docker_temp_server_start &quot;$@&quot;</span><br><span class="line">                        mysql_note &quot;Temporary server started.&quot;</span><br><span class="line"></span><br><span class="line">                        mysql_socket_fix</span><br><span class="line">                        docker_setup_db</span><br><span class="line">                        docker_process_init_files /docker-entrypoint-initdb.d/*</span><br><span class="line"></span><br><span class="line">                        mysql_expire_root_user</span><br><span class="line"></span><br><span class="line">                        mysql_note &quot;Stopping temporary server&quot;</span><br><span class="line">                        docker_temp_server_stop</span><br><span class="line">                        mysql_note &quot;Temporary server stopped&quot;</span><br><span class="line"></span><br><span class="line">                        echo</span><br><span class="line">                        mysql_note &quot;MySQL init process done. Ready for start up.&quot;</span><br><span class="line">                        echo</span><br><span class="line">                else</span><br><span class="line">                        mysql_socket_fix</span><br><span class="line">                fi</span><br><span class="line">        fi</span><br><span class="line">        exec &quot;$@&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="入口"><a href="#入口" class="headerlink" title="入口"></a>入口</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if ! _is_sourced; then</span><br><span class="line">        _main &quot;$@&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="分析脚本"><a href="#分析脚本" class="headerlink" title="分析脚本"></a>分析脚本</h1><h2 id="判断脚本的运行方式"><a href="#判断脚本的运行方式" class="headerlink" title="判断脚本的运行方式"></a>判断脚本的运行方式</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ! _is_sourced; then			# _is_sourced为假则开始运行主函数</span><br><span class="line">        _main &quot;$@&quot;   			# 进入主函数并携带所有的参数</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">_is_sourced() &#123;</span><br><span class="line">        [ &quot;$&#123;#FUNCNAME[@]&#125;&quot; -ge 2 ] \</span><br><span class="line">                &amp;&amp; [ &quot;$&#123;FUNCNAME[0]&#125;&quot; = &#x27;_is_sourced&#x27; ] \</span><br><span class="line">                &amp;&amp; [ &quot;$&#123;FUNCNAME[1]&#125;&quot; = &#x27;source&#x27; ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">FUNCNAME表示函数的名字，它是一个数组变量，其中包含了整个调用链上所有的函数的名字，故变量<span class="variable">$&#123;FUNCNAME[0]&#125;</span>代表shell脚本当前正在执行的函数的名字，而变量<span class="variable">$&#123;FUNCNAME[1]&#125;</span>则代表调用函数<span class="variable">$&#123;FUNCNAME[0]&#125;</span>的函数的名字，依此类推。</span></span><br><span class="line"></span><br><span class="line">如果是./执行则函数为假执行_main函数，如果是source则为真不执行_main</span><br></pre></td></tr></table></figure>

<h2 id="进入主函数"><a href="#进入主函数" class="headerlink" title="进入主函数"></a>进入主函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">_main() &#123;</span><br><span class="line">        # 判断CMD提供的命令是否是mysqld -xxx -xxx的形式   $&#123;1:0:1&#125;即第二个字符串的第一个字符是否是-；如果是就执行CMD给定的参数</span><br><span class="line">        if [ &quot;$&#123;1:0:1&#125;&quot; = &#x27;-&#x27; ]; then   </span><br><span class="line">                set -- mysqld &quot;$@&quot;			# $@表示所有参数  </span><br><span class="line">                # set -- 后无内容，将当前 shell 脚本的参数置空，$1 $? $@ 等都为空。</span><br><span class="line">				# set -- 后有内容，当前 shell 脚本的参数被替换为 set -- 后的内容，$1 $? $@ 等相应地被改变。</span><br><span class="line">        fi</span><br><span class="line">   </span><br><span class="line">        # 判断第一个参数是否为mysqld并且将所有参数传递给_mysql_want_help函数,跳到_mysql_want_help函数</span><br><span class="line">        if [ &quot;$1&quot; = &#x27;mysqld&#x27; ] &amp;&amp; ! _mysql_want_help &quot;$@&quot;; then    </span><br><span class="line">                mysql_note &quot;Entrypoint script for MySQL Server $&#123;MYSQL_VERSION&#125; started.&quot;</span><br><span class="line">				# 将信息传到日志函数</span><br><span class="line">				</span><br><span class="line">                mysql_check_config &quot;$@&quot;</span><br><span class="line">                # 检查配置</span><br><span class="line">                </span><br><span class="line">                docker_setup_env &quot;$@&quot;</span><br><span class="line">                # 将传入的值作为环境变量</span><br><span class="line">                </span><br><span class="line">                docker_create_db_directories &quot;$@&quot;</span><br><span class="line">				# 创建数据库目录</span><br><span class="line"></span><br><span class="line">                # 判断用户是否为root得切换mysql用户启动</span><br><span class="line">                if [ &quot;$(id -u)&quot; = &quot;0&quot; ]; then</span><br><span class="line">                        mysql_note &quot;Switching to dedicated user &#x27;mysql&#x27;&quot;</span><br><span class="line">                        exec gosu mysql &quot;$BASH_SOURCE&quot; &quot;$@&quot;</span><br><span class="line">                fi</span><br><span class="line"></span><br><span class="line">                # 在环境变量函数中就判断数据目录是否存在   -z判断变量是否为空，如果是空就执行下面的初始化过程</span><br><span class="line">                if [ -z &quot;$DATABASE_ALREADY_EXISTS&quot; ]; then			</span><br><span class="line">                        docker_verify_minimum_env</span><br><span class="line"></span><br><span class="line">                        # check dir permissions to reduce likelihood of half-initialized database</span><br><span class="line">                        ls /docker-entrypoint-initdb.d/ &gt; /dev/null</span><br><span class="line"></span><br><span class="line">                        docker_init_database_dir &quot;$@&quot;</span><br><span class="line"></span><br><span class="line">                        mysql_note &quot;Starting temporary server&quot;</span><br><span class="line">                        docker_temp_server_start &quot;$@&quot;</span><br><span class="line">                        mysql_note &quot;Temporary server started.&quot;</span><br><span class="line"></span><br><span class="line">                        mysql_socket_fix</span><br><span class="line">                        docker_setup_db</span><br><span class="line">                        docker_process_init_files /docker-entrypoint-initdb.d/*</span><br><span class="line"></span><br><span class="line">                        mysql_expire_root_user</span><br><span class="line"></span><br><span class="line">                        mysql_note &quot;Stopping temporary server&quot;</span><br><span class="line">                        docker_temp_server_stop</span><br><span class="line">                        mysql_note &quot;Temporary server stopped&quot;</span><br><span class="line"></span><br><span class="line">                        echo</span><br><span class="line">                        mysql_note &quot;MySQL init process done. Ready for start up.&quot;</span><br><span class="line">                        echo</span><br><span class="line">                else</span><br><span class="line">                        mysql_socket_fix</span><br><span class="line">                fi</span><br><span class="line">        fi</span><br><span class="line">        exec &quot;$@&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="检查是否包含导进程停止的参数函数-1"><a href="#检查是否包含导进程停止的参数函数-1" class="headerlink" title="检查是否包含导进程停止的参数函数"></a>检查是否包含导进程停止的参数函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">_mysql_want_help() &#123;</span><br><span class="line">        local arg		# 将传递进来的变量作为局部变量arg</span><br><span class="line">        for arg; do</span><br><span class="line">                case &quot;$arg&quot; in		# 判断变量(参数)是否包含如下选项是这返回0否则返回1</span><br><span class="line">                        -&#x27;?&#x27;|--help|--print-defaults|-V|--version)</span><br><span class="line">                                return 0</span><br><span class="line">                                ;;</span><br><span class="line">                esac</span><br><span class="line">        done</span><br><span class="line">        return 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="记录日志函数"><a href="#记录日志函数" class="headerlink" title="记录日志函数"></a>记录日志函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql_note() &#123;</span><br><span class="line">        mysql_log Note &quot;$@&quot;			# 将传入的值进行记录</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="检查配置函数"><a href="#检查配置函数" class="headerlink" title="检查配置函数"></a>检查配置函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql_check_config() &#123;</span><br><span class="line">        local toRun=( &quot;$@&quot; &quot;$&#123;_verboseHelpArgs[@]&#125;&quot; ) errors</span><br><span class="line">        if ! errors=&quot;$(&quot;$&#123;toRun[@]&#125;&quot; 2&gt;&amp;1 &gt;/dev/null)&quot;; then</span><br><span class="line">                mysql_error $&#x27;mysqld failed while attempting to check config\n\tcommand was: &#x27;&quot;$&#123;toRun[*]&#125;&quot;$&#x27;\n\t&#x27;&quot;$errors&quot;</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="设置环境变量函数"><a href="#设置环境变量函数" class="headerlink" title="设置环境变量函数"></a>设置环境变量函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">docker_setup_env() &#123;</span><br><span class="line">        # Get config</span><br><span class="line">        declare -g DATADIR SOCKET</span><br><span class="line">        DATADIR=&quot;$(mysql_get_config &#x27;datadir&#x27; &quot;$@&quot;)&quot;</span><br><span class="line">        SOCKET=&quot;$(mysql_get_config &#x27;socket&#x27; &quot;$@&quot;)&quot;</span><br><span class="line"></span><br><span class="line">        # Initialize values that might be stored in a file</span><br><span class="line">        file_env &#x27;MYSQL_ROOT_HOST&#x27; &#x27;%&#x27;</span><br><span class="line">        file_env &#x27;MYSQL_DATABASE&#x27;</span><br><span class="line">        file_env &#x27;MYSQL_USER&#x27;</span><br><span class="line">        file_env &#x27;MYSQL_PASSWORD&#x27;</span><br><span class="line">        file_env &#x27;MYSQL_ROOT_PASSWORD&#x27;</span><br><span class="line"></span><br><span class="line">        declare -g DATABASE_ALREADY_EXISTS</span><br><span class="line">        if [ -d &quot;$DATADIR/mysql&quot; ]; then			# 判断数据目录是否存在</span><br><span class="line">                DATABASE_ALREADY_EXISTS=&#x27;true&#x27;</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建数据库目录函数"><a href="#创建数据库目录函数" class="headerlink" title="创建数据库目录函数"></a>创建数据库目录函数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">docker_create_db_directories() &#123;</span><br><span class="line">        local user; user=&quot;$(id -u)&quot;</span><br><span class="line"></span><br><span class="line">        local -A dirs=( [&quot;$DATADIR&quot;]=1 )</span><br><span class="line">        local dir</span><br><span class="line">        dir=&quot;$(dirname &quot;$SOCKET&quot;)&quot;</span><br><span class="line">        dirs[&quot;$dir&quot;]=1</span><br><span class="line"></span><br><span class="line">        # &quot;datadir&quot; and &quot;socket&quot; are already handled above (since they were already queried previously)</span><br><span class="line">        local conf</span><br><span class="line">        for conf in \</span><br><span class="line">                general-log-file \</span><br><span class="line">                keyring_file_data \</span><br><span class="line">                pid-file \</span><br><span class="line">                secure-file-priv \</span><br><span class="line">                slow-query-log-file \</span><br><span class="line">        ; do</span><br><span class="line">                dir=&quot;$(mysql_get_config &quot;$conf&quot; &quot;$@&quot;)&quot;</span><br><span class="line"></span><br><span class="line">                # skip empty values</span><br><span class="line">                if [ -z &quot;$dir&quot; ] || [ &quot;$dir&quot; = &#x27;NULL&#x27; ]; then</span><br><span class="line">                        continue</span><br><span class="line">                fi</span><br><span class="line">                case &quot;$conf&quot; in</span><br><span class="line">                        secure-file-priv)</span><br><span class="line">                                # already points at a directory</span><br><span class="line">                                ;;</span><br><span class="line">                        *)</span><br><span class="line">                                # other config options point at a file, but we need the directory</span><br><span class="line">                                dir=&quot;$(dirname &quot;$dir&quot;)&quot;</span><br><span class="line">                                ;;</span><br><span class="line">                esac</span><br><span class="line"></span><br><span class="line">                dirs[&quot;$dir&quot;]=1</span><br><span class="line">        done</span><br><span class="line"></span><br><span class="line">        mkdir -p &quot;$&#123;!dirs[@]&#125;&quot;</span><br><span class="line"></span><br><span class="line">        if [ &quot;$user&quot; = &quot;0&quot; ]; then</span><br><span class="line">                # this will cause less disk access than `chown -R`</span><br><span class="line">                find &quot;$&#123;!dirs[@]&#125;&quot; \! -user mysql -exec chown --no-dereference mysql &#x27;&#123;&#125;&#x27; +</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://www.xiaowangc.com">尤妤</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.xiaowangc.com/archives/8baf922f.html">https://www.xiaowangc.com/archives/8baf922f.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.xiaowangc.com" target="_blank">尤妤</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/Shell/">Shell</a></div><div class="post_share"><div class="social-share" data-image="/img/fengmian/linux.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/archives/4d672e21.html"><img class="prev-cover" src="/img/fengmian/gitlab.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">AWT is not properly configured on this server.</div></div></a></div><div class="next-post pull-right"><a href="/archives/736ef7f1.html"><img class="next-cover" src="/img/fengmian/docker.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">个人生成的Docker镜像</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/archives/bd4820af.html" title="Poste.io邮件服务器"><img class="cover" src="/img/fengmian/email.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-16</div><div class="title">Poste.io邮件服务器</div></div></a></div><div><a href="/archives/993b501c.html" title="Linux基于legacy(BIOS)引导过程"><img class="cover" src="/img/fengmian/linux.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-24</div><div class="title">Linux基于legacy(BIOS)引导过程</div></div></a></div><div><a href="/archives/ccf900ab.html" title="Linux开启IP路由"><img class="cover" src="/img/fengmian/linux.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-23</div><div class="title">Linux开启IP路由</div></div></a></div><div><a href="/archives/6dcdc915.html" title="CentOS8安装中文语言包"><img class="cover" src="/img/fengmian/linux.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-23</div><div class="title">CentOS8安装中文语言包</div></div></a></div><div><a href="/archives/9b886d63.html" title="CentoOS8 TLS目录"><img class="cover" src="/img/fengmian/openssl.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-23</div><div class="title">CentoOS8 TLS目录</div></div></a></div><div><a href="/archives/e54f90b7.html" title="LVM实现数据一致性备份迁移"><img class="cover" src="/img/fengmian/linux.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-24</div><div class="title">LVM实现数据一致性备份迁移</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">尤妤</div><div class="author-info__description">欢迎来到尤妤的博客</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">58</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">53</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=780312916&amp;site=qq&amp;menu=yes"><i class="fa-brands fa-qq"></i><span>联系尤妤</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:admin@xiaowangc.com" target="_blank" title="邮箱"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.xiaowangc.com/baidusitemap.xml" target="_blank" title="站点地图"><i class="fas fa-map-location-dot"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">如果阅读过程中遇到了问题，请联系尤妤</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Shell%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">Shell基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Bash%E6%B3%A8%E9%87%8A"><span class="toc-number">1.1.</span> <span class="toc-text">Bash注释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bash%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">Bash基本数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bash%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%B2%E8%81%94"><span class="toc-number">1.3.</span> <span class="toc-text">Bash字符串串联</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E8%B5%8B%E5%80%BC%E5%92%8C%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F"><span class="toc-number">1.4.</span> <span class="toc-text">变量赋值和引用变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.5.</span> <span class="toc-text">命令替换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97"><span class="toc-number">1.6.</span> <span class="toc-text">算数运算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">1.7.</span> <span class="toc-text">退出状态码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exit%E5%91%BD%E4%BB%A4"><span class="toc-number">1.8.</span> <span class="toc-text">Exit命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4-amp"><span class="toc-number">1.9.</span> <span class="toc-text">后台执行命令&amp;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E5%91%BD%E4%BB%A4%E7%BB%84%E5%90%88"><span class="toc-number">1.10.</span> <span class="toc-text">多命令组合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E5%91%BD%E4%BB%A4%E7%BB%84%E5%90%88"><span class="toc-number">1.11.</span> <span class="toc-text">多个命令组合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.12.</span> <span class="toc-text">重定向</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E6%93%8D%E4%BD%9C"><span class="toc-number">1.12.1.</span> <span class="toc-text">重定向操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cat%E5%91%BD%E4%BB%A4"><span class="toc-number">1.12.2.</span> <span class="toc-text">cat命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#here-docer"><span class="toc-number">1.12.3.</span> <span class="toc-text">here docer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%A1%E9%81%93"><span class="toc-number">1.13.</span> <span class="toc-text">管道</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tee%E5%91%BD%E4%BB%A4"><span class="toc-number">1.14.</span> <span class="toc-text">tee命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.15.</span> <span class="toc-text">条件测试语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#if%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.16.</span> <span class="toc-text">if语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#case"><span class="toc-number">1.17.</span> <span class="toc-text">case</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#for%E5%BE%AA%E7%8E%AF"><span class="toc-number">1.18.</span> <span class="toc-text">for循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#while%E5%BE%AA%E7%8E%AF"><span class="toc-number">1.19.</span> <span class="toc-text">while循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell%E5%87%BD%E6%95%B0"><span class="toc-number">1.20.</span> <span class="toc-text">Shell函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5%EF%BC%9A%E5%88%86%E6%9E%90%E4%B8%80%E6%AE%B5Shell%E8%84%9A%E6%9C%AC"><span class="toc-number">1.21.</span> <span class="toc-text">实践：分析一段Shell脚本</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%B0%E4%B8%80%E6%AC%A1MySQL-Shell%E5%AD%A6%E4%B9%A0"><span class="toc-number">2.</span> <span class="toc-text">记一次MySQL-Shell学习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.</span> <span class="toc-text">日志记录函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8F%98%E9%87%8F%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.</span> <span class="toc-text">文件变量函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E6%96%87%E4%BB%B6%E6%9C%AC%E8%BA%AB%E5%87%BD%E6%95%B0"><span class="toc-number">2.3.</span> <span class="toc-text">检测文件本身函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%87%E4%BB%B6%E5%87%BD%E6%95%B0"><span class="toc-number">2.4.</span> <span class="toc-text">进程初始化文件函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E9%85%8D%E7%BD%AE%E5%87%BD%E6%95%B0"><span class="toc-number">2.5.</span> <span class="toc-text">检测配置函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E5%87%BD%E6%95%B0"><span class="toc-number">2.6.</span> <span class="toc-text">获取配置函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A5%97%E6%8E%A5%E5%AD%97%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.</span> <span class="toc-text">套接字函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%B4%E6%97%B6%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E5%87%BD%E6%95%B0"><span class="toc-number">2.8.</span> <span class="toc-text">临时启动服务函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2%E4%B8%B4%E6%97%B6%E6%9C%8D%E5%8A%A1%E5%87%BD%E6%95%B0"><span class="toc-number">2.9.</span> <span class="toc-text">停止临时服务函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%AF%86%E7%A0%81%E5%87%BD%E6%95%B0"><span class="toc-number">2.10.</span> <span class="toc-text">检查密码函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%87%E4%BB%B6%E5%87%BD%E6%95%B0"><span class="toc-number">2.11.</span> <span class="toc-text">创建数据库文件函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%AE%E5%BD%95%E5%87%BD%E6%95%B0"><span class="toc-number">2.12.</span> <span class="toc-text">初始化数据库目录函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">2.13.</span> <span class="toc-text">设置环境变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A7%E8%A1%8CSQL%E8%84%9A%E6%9C%AC%E5%87%BD%E6%95%B0"><span class="toc-number">2.14.</span> <span class="toc-text">执行SQL脚本函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%BD%E6%95%B0"><span class="toc-number">2.15.</span> <span class="toc-text">初始化数据库函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E6%98%BE%E5%AF%86%E7%A0%81%E5%87%BD%E6%95%B0"><span class="toc-number">2.16.</span> <span class="toc-text">回显密码函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E5%BF%97ROOT%E8%BF%87%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">2.17.</span> <span class="toc-text">标志ROOT过期函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%8C%85%E5%90%AB%E5%AF%BC%E8%BF%9B%E7%A8%8B%E5%81%9C%E6%AD%A2%E7%9A%84%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0"><span class="toc-number">2.18.</span> <span class="toc-text">检查是否包含导进程停止的参数函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E5%87%BD%E6%95%B0"><span class="toc-number">2.19.</span> <span class="toc-text">主函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A5%E5%8F%A3"><span class="toc-number">2.20.</span> <span class="toc-text">入口</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E8%84%9A%E6%9C%AC"><span class="toc-number">3.</span> <span class="toc-text">分析脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E8%84%9A%E6%9C%AC%E7%9A%84%E8%BF%90%E8%A1%8C%E6%96%B9%E5%BC%8F"><span class="toc-number">3.1.</span> <span class="toc-text">判断脚本的运行方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E4%B8%BB%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.</span> <span class="toc-text">进入主函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%8C%85%E5%90%AB%E5%AF%BC%E8%BF%9B%E7%A8%8B%E5%81%9C%E6%AD%A2%E7%9A%84%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0-1"><span class="toc-number">3.3.</span> <span class="toc-text">检查是否包含导进程停止的参数函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97%E5%87%BD%E6%95%B0"><span class="toc-number">3.4.</span> <span class="toc-text">记录日志函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E5%87%BD%E6%95%B0"><span class="toc-number">3.5.</span> <span class="toc-text">检查配置函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%87%BD%E6%95%B0"><span class="toc-number">3.6.</span> <span class="toc-text">设置环境变量函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%AE%E5%BD%95%E5%87%BD%E6%95%B0"><span class="toc-number">3.7.</span> <span class="toc-text">创建数据库目录函数</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/archives/bc2a8490.html" title="Linux证书有效期检测脚本"><img src="/img/fengmian/linux.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux证书有效期检测脚本"/></a><div class="content"><a class="title" href="/archives/bc2a8490.html" title="Linux证书有效期检测脚本">Linux证书有效期检测脚本</a><time datetime="2023-01-21T18:51:55.000Z" title="发表于 2023-01-22 02:51:55">2023-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/e3278faf.html" title="关于Kubernetes配置私有镜像仓库"><img src="/img/fengmian/k8s.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="关于Kubernetes配置私有镜像仓库"/></a><div class="content"><a class="title" href="/archives/e3278faf.html" title="关于Kubernetes配置私有镜像仓库">关于Kubernetes配置私有镜像仓库</a><time datetime="2023-01-21T09:19:38.000Z" title="发表于 2023-01-21 17:19:38">2023-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/d89a6add.html" title="Containerd安装脚本"><img src="/img/fengmian/k8s.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Containerd安装脚本"/></a><div class="content"><a class="title" href="/archives/d89a6add.html" title="Containerd安装脚本">Containerd安装脚本</a><time datetime="2023-01-20T12:03:22.000Z" title="发表于 2023-01-20 20:03:22">2023-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/93a87db7.html" title="ES&amp;Kibana安装配置"><img src="/img/fengmian/elastic_logo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ES&amp;Kibana安装配置"/></a><div class="content"><a class="title" href="/archives/93a87db7.html" title="ES&amp;Kibana安装配置">ES&amp;Kibana安装配置</a><time datetime="2023-01-10T07:32:11.000Z" title="发表于 2023-01-10 15:32:11">2023-01-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/bd4820af.html" title="Poste.io邮件服务器"><img src="/img/fengmian/email.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Poste.io邮件服务器"/></a><div class="content"><a class="title" href="/archives/bd4820af.html" title="Poste.io邮件服务器">Poste.io邮件服务器</a><time datetime="2022-12-16T02:39:37.000Z" title="发表于 2022-12-16 10:39:37">2022-12-16</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/fengmian/linux.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 尤妤</div><div class="framework-info"><span><a href="https://hexo.io/" target="_blank" title="由 Halo 强力驱动" style="text-decoration:none;"><span style="color: #fff;border-bottom-left-radius: 4px;border-top-left-radius: 4px;background-color: #505050;padding: 1px 3px 1px 3px;" ><img src="https://www.xiaowangc.com/img/hexo.png" style="vertical-align:text-bottom">&nbsp</i>Powered</span><span data-v-625f2a9e="" style="color: #fff;padding: 1px 3px 1px 3px;background-color: #007ec6!important;border-top-right-radius: 4px;border-bottom-right-radius: 4px;">Hexo v6.2.0</span></a></span>
<span><a href="https://cloud.tencent.com/" target="_blank" title="由Tencent Cloud托管" style="text-decoration:none;"><span style="color: #fff;border-bottom-left-radius: 4px;border-top-left-radius: 4px;background-color: #505050;padding: 1px 3px 1px 3px;" ><i class="fa-brands fa-docker">&nbsp</i>Trusteeship</span><span data-v-625f2a9e="" style="color: #fff;padding: 1px 3px 1px 3px;background-color: #44e0c0!important;border-top-right-radius: 4px;border-bottom-right-radius: 4px;">Tencent Cloud</span></a></span>
<span><a href="https://beian.miit.gov.cn/" target="_blank" title="ICP备案" style="text-decoration:none;"><span style="color: #fff;border-bottom-left-radius: 4px;border-top-left-radius: 4px;background-color: #505050;padding: 1px 3px 1px 3px;"><img src="https://www.xiaowangc.com/img/icp.png" style="vertical-align:text-bottom">&nbsp</i>蜀ICP备</span><span data-v-625f2a9e="" style="color: #fff;padding: 1px 3px 1px 3px;background-color: red!important;border-top-right-radius: 4px;border-bottom-right-radius: 4px;">2022002393-1号</span></a></span>
<span><a href="https://icp.gov.moe/" target="_blank" title="萌国备案" style="text-decoration:none;"><span style="color: #fff;border-bottom-left-radius: 4px;border-top-left-radius: 4px;background-color: #505050;padding: 1px 3px 1px 3px;"><img src="https://www.xiaowangc.com/img/mb.ico" style="vertical-align:text-bottom">&nbsp</i>萌备</span><span data-v-625f2a9e="" style="color: #fff;padding: 1px 3px 1px 3px;background-color: orange!important;border-top-right-radius: 4px;border-bottom-right-radius: 4px;">20220706号</span></a></span>
<span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" title="主题" style="text-decoration:none;"><span style="color: #fff;border-bottom-left-radius: 4px;border-top-left-radius: 4px;background-color: #505050;padding: 1px 3px 1px 3px;"><i class="fa-brands fa-github"></i>&nbsp</i>Theme</span><span data-v-625f2a9e="" style="color: #fff;padding: 1px 3px 1px 3px;background-color: #4dc820!important;border-top-right-radius: 4px;border-bottom-right-radius: 4px;">Butterfly</span></a></span></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" style="text-decoration:none;"><span>本网站由</span><img src="https://www.xiaowangc.com/img/y_logo5.png" width="48" height="24" style="vertical-align:text-bottom"></img><span>提供CDN加速/云存储服务</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script data-pjax defer src="https://npm.elemecdn.com/tzy-blog/lib/js/theme/chocolate.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>